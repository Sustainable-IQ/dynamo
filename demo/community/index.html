<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DYNAMO Community Dashboard (Mock)</title>
<style>
  :root{
    --bg:#0a1020; --muted:#a9b4c3; --accent:#7c3aed; --accent-2:#4f46e5; --success:#10b981; --warn:#f59e0b;
    --left-1:#0a1c2d; --left-2:#0b1526;
    --right-1:#150f2d; --right-2:#0f1426;
    --center-1:rgba(255,255,255,0.02); --center-2:rgba(255,255,255,0.01);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{margin:0; background:linear-gradient(180deg,#071024 0%, #081426 60%); color:#e6eef6; min-height:100vh;}
  .top-nav{background:rgba(0,0,0,0.3);padding:12px 26px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.1);}
  .dynamo-logo{font-size:24px;font-weight:900;color:#fbbf24;letter-spacing:1px;text-decoration:none;cursor:pointer;}
  .dynamo-logo:hover{color:#fcd34d;}
  .tagline{font-size:18px;color:#ffffff;font-weight:600;position:absolute;left:50%;transform:translateX(-50%);animation:heartbeat 6s ease-in-out infinite;}
  @keyframes heartbeat {
    0% { transform: translateX(-50%) scale(1); }
    14% { transform: translateX(-50%) scale(1.05); }
    28% { transform: translateX(-50%) scale(1); }
    42% { transform: translateX(-50%) scale(1.05); }
    70% { transform: translateX(-50%) scale(1); }
  }
  .login-btn{background:transparent;border:1px solid rgba(255,255,255,0.2);padding:8px 16px;border-radius:6px;color:#e6eef6;cursor:pointer;font-weight:600;font-size:14px;transition:all 0.3s;}
  .login-btn:hover {
    background:rgba(255,255,255,0.1);
    border-color:rgba(255,255,255,0.3);}

  /* Layout */
  .app{display:grid;grid-template-columns: 300px 1.8fr 360px;gap:18px; padding:0 26px 26px; max-width:1700px; margin:0 auto;}
  .panel{border-radius:14px; padding:16px; box-shadow: 0 6px 24px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.05);}
  .left{min-height:76vh; background:linear-gradient(180deg,var(--left-1),var(--left-2)); display:flex; flex-direction:column; gap:12px;}
  .center{min-height:76vh; background:linear-gradient(180deg, var(--center-1), var(--center-2)); display:flex; flex-direction:column; gap:12px;}
  .right{height:86vh; overflow:auto; background:linear-gradient(180deg,var(--right-1),var(--right-2)); display:flex; flex-direction:column; gap:12px;}
  .section-title{font-size:12px; letter-spacing:.2px; color:var(--muted); margin:4px 0 8px 0; text-transform:uppercase;}
  .hr{border:none;height:1px;background:rgba(255,255,255,0.06);margin:8px 0;}
  .btn{background:transparent; border:1px solid rgba(255,255,255,0.10); padding:8px 10px; border-radius:10px; cursor:pointer; color:#dbeafe; font-size:12px;}
  .btn.primary{background:linear-gradient(90deg,var(--accent), var(--accent-2)); box-shadow:0 8px 18px rgba(124,58,237,0.28); border:none; color:#fff;}
  .chip{display:inline-flex;gap:6px;align-items:center;padding:6px 8px;border-radius:999px;border:1px solid rgba(255,255,255,0.10); background:rgba(255,255,255,0.03);font-size:12px;}
  .muted{color:var(--muted);}

  /* Global divider style */
  hr {
    border: none; 
    height: 1px;
    background: rgba(255,255,255,0.06);
    margin: 12px 0;
  }
  
  /* Left: Active Threads + Packs + Feed */
  .thread-item{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.03);margin-bottom:8px;cursor:pointer;}
  .thread-item:hover{border-color:rgba(255,255,255,0.15);}
  .thread-meta{display:flex;gap:8px;align-items:center;font-size:11px;color:var(--muted);}
  .pack-card{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.03);margin-bottom:8px;}
  .feed-item{margin-bottom:8px;padding:8px;background:rgba(255,255,255,0.03);border-radius:8px;border:1px solid rgba(255,255,255,0.06);font-size:12px;color:var(--muted);}

  /* Center: Living Thread + chat I/O */
  .header-row{display:flex;justify-content:space-between;align-items:center;}
  .lens-tabs{display:flex;gap:8px;flex-wrap:wrap;}
  .tab{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.10); background:rgba(255,255,255,0.03);font-size:12px;cursor:pointer;color:white;}
  .tab.active{border-color:rgba(124,58,237,0.6);box-shadow:0 0 0 2px rgba(124,58,237,0.15) inset;}
  .lens{display:none;border-radius:12px;border:1px solid rgba(255,255,255,0.05);padding:12px;background:rgba(255,255,255,0.02);min-height:160px;max-height:320px;overflow:auto;}
  .lens.active{display:block;}
  .dialogue-msg{margin-bottom:10px;}
  .decision-row,.question-row{display:flex;justify-content:space-between;gap:10px;border-bottom:1px dashed rgba(255,255,255,0.08);padding:6px 0;font-size:13px;}
  .io-wrap{margin-top:auto;background:linear-gradient(180deg, transparent, rgba(10,16,32,0.85) 50%); padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);}
  .io-row{display:flex;gap:8px;}
  .io-row textarea{flex:1;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.12);color:#e6eef6;min-height:60px;resize:vertical;}
  .io-row button{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;}
  .output-box{margin-top:8px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.10);background:rgba(255,255,255,0.03);min-height:60px;font-size:13px;}

  /* Right: Pulse, Scheduler, Docs, Ledger */
  .pulse-card{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.03);}
  .slot{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);margin-bottom:6px;font-size:12px;}
  .ledger-item{font-size:12px;color:var(--muted);margin-bottom:6px;border-bottom:1px solid rgba(255,255,255,0.06);padding-bottom:6px;}
  .success{color:#86efac;}
  .warn{color:#fde68a;}
  .danger{color:#fca5a5;}
  @media (max-width:1100px){
    .app{grid-template-columns: 1fr; padding:0 12px 12px}
    .left,.center,.right{min-height:auto}
  }
</style>
</head>
<body>
<!-- TOP NAVIGATION BAR -->
<div class="top-nav">
  <a href="#" class="dynamo-logo">DYNAMO</a>
  <div class="tagline">Community Intelligence Console</div>
  <button class="login-btn" id="loginBtn">LOG IN</button>
</div>

<!-- MAIN APP GRID -->
<div class="app">
  <!-- LEFT: Threads, Packs, Feed -->
  <div class="panel left">
    <div>
      <div class="section-title"><strong>Active Threads</strong></div>
      <hr>
      <button class="btn" id="newThreadBtn">New Thread</button>
      <hr>
      <div id="threadList"></div>
    </div>
      <hr>
      <div>
        <div class="section-title"><strong>Agent Pack Shelf</strong></div>
        <div id="packShelf"></div>
        <div class="muted" style="font-size:11px;">Attach a Pack to the selected thread to auto-run synthesis, decisions, questions, scheduling, or docs.</div>
      </div>
      <hr>
    <div>
      <div class="section-title"><strong>Community Feed</strong></div>
      <div id="communityFeed"></div>
    </div>
  </div>

  <!-- CENTER: Living Thread + I/O -->
  <div class="panel center">
    <div class="header-row">
      <div>
        <div class="section-title">Living Thread</div>
        <div id="threadTitle" style="font-size:18px;font-weight:800;">No thread selected</div>
        <div class="muted" id="threadSubtitle" style="font-size:12px;">Select a thread on the left.</div>
      </div>
      <div class="lens-tabs" role="tablist" aria-label="Thread lenses">
        <button class="tab active" data-lens="dialogue">Dialogue</button>
        <button class="tab" data-lens="synthesis">Synthesis</button>
        <button class="tab" data-lens="decisions">Decisions</button>
        <button class="tab" data-lens="questions">Open Questions</button>
      </div>
    </div>

    <div id="lens-dialogue" class="lens active" aria-live="polite"></div>
    <div id="lens-synthesis" class="lens"></div>
    <div id="lens-decisions" class="lens"></div>
    <div id="lens-questions" class="lens"></div>

    <div class="io-wrap">
      <div class="section-title">Ask / Contribute</div>
      <div class="io-row">
        <textarea id="userInput" placeholder="Offer insight or ask a question to the Council…"></textarea>
        <button class="btn primary" id="sendBtn">Send</button>
      </div>
      <div class="output-box" id="councilOutput">Council output will appear here.</div>
      <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
        <button class="btn" id="pulseBtn">Emit Pulse</button>
        <button class="btn" id="proposeMeetingBtn">Propose Meeting</button>
        <button class="btn" id="draftDocBtn">Draft Doc</button>
        <button class="btn" id="reviveBtn">Revive Thread</button>
      </div>
    </div>
  </div>

  <!-- RIGHT: Pulse, Scheduler, Docs, Ledger -->
  <div class="panel right">
    <h2>Dynamo Community</h2>
    <button class="btn" id="showAllCommsBtn" style="background:#06b6d4;color:white;border:none;padding:8px 12px;width:fit-content;">Go To DYNAMO Council Chat</button>
    <hr>
    <div>
      <div class="section-title">Community Pulse</div>
      <div id="pulseCard" class="pulse-card">
        <div><strong>This week</strong></div>
        <ul id="pulseList" style="margin:8px 0 0 18px; padding:0;">
          <li>0 decisions logged</li>
          <li>0 open questions answered</li>
          <li>0 threads revived</li>
        </ul>
      </div>
    </div>
    <hr>
    <div>
      <div class="section-title">Scheduler Proposals</div>
      <div id="slots"></div>
    </div>
    <hr>
    <div>
      <div class="section-title">Doc Drafts</div>
      <div id="docDrafts"></div>
    </div>
    <hr>
    <div>
      <div class="section-title">Tool Action Ledger</div>
      <div id="ledger"></div>
    </div>
  </div>
</div>

<script src="demodata.js"></script>
<script>
/* ---------- Demo State ---------- */
// threads and packs are now imported from demodata.js

let selectedThreadId = null;
const ledger = [];
const docDrafts = [];
let weekPulse = { decisions: 0, answered: 0, revived: 0 };

/* ---------- DOM Refs ---------- */
const threadList = document.getElementById("threadList");
const packShelf = document.getElementById("packShelf");
const communityFeed = document.getElementById("communityFeed");
const threadTitle = document.getElementById("threadTitle");
const threadSubtitle = document.getElementById("threadSubtitle");
const lensDialogue = document.getElementById("lens-dialogue");
const lensSynthesis = document.getElementById("lens-synthesis");
const lensDecisions = document.getElementById("lens-decisions");
const lensQuestions = document.getElementById("lens-questions");
const councilOutput = document.getElementById("councilOutput");
const userInput = document.getElementById("userInput");
const pulseList = document.getElementById("pulseList");
const slots = document.getElementById("slots");
const ledgerEl = document.getElementById("ledger");
const docDraftsEl = document.getElementById("docDrafts");

/* ---------- Renderers ---------- */
function renderThreads(){
  threadList.innerHTML = "";
  threads.forEach(t=>{
    const div = document.createElement("div");
    div.className = "thread-item";
    div.innerHTML = `
      <div style="font-weight:700">${t.title}</div>
      <div class="thread-meta">
        <span class="chip">${t.packs.length} packs</span>
        <span class="chip">${t.decisions.length} decisions</span>
        <span class="chip">${t.questions.length} questions</span>
      </div>
    `;
    div.addEventListener("click",()=>selectThread(t.id));
    threadList.appendChild(div);
  });
}

function renderPacks(){
  packShelf.innerHTML = "";
  packs.forEach(p=>{
    const card = document.createElement("div");
    card.className = "pack-card";
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div style="font-weight:700">${p.name}</div>
          <div class="muted" style="font-size:12px;">${p.roles.join(", ")}</div>
        </div>
        <button class="btn" data-pack="${p.id}">Attach</button>
      </div>
    `;
    card.querySelector("button").addEventListener("click",()=>attachPack(p.id));
    packShelf.appendChild(card);
  });
}

function renderFeed(msg){
  const item = document.createElement("div");
  item.className = "feed-item";
  item.textContent = msg;
  communityFeed.prepend(item);
}

function renderThread(){
  const t = currentThread();
  if(!t){
    threadTitle.textContent = "No thread selected";
    threadSubtitle.textContent = "Select a thread on the left.";
    [lensDialogue,lensSynthesis,lensDecisions,lensQuestions].forEach(el=>el.innerHTML="");
    return;
  }
  threadTitle.textContent = t.title;
  threadSubtitle.innerHTML = `<span class="muted">${t.tags.join(" • ")}</span> — <span class="muted">${t.packs.length} packs attached</span>`;

  lensDialogue.innerHTML = t.dialogue.map(d=>(
    `<div class="dialogue-msg">
       <div style="font-weight:600">${escapeHtml(d.author)}</div>
       <div>${escapeHtml(d.text)}</div>
     </div>`
  )).join("") || `<div class="muted">No messages yet.</div>`;

  lensSynthesis.innerHTML = t.synthesis
    ? `<div>${escapeHtml(t.synthesis)}</div>`
    : `<div class="muted">No synthesis yet. Attach a Pack or click “Emit Pulse”.</div>`;

  lensDecisions.innerHTML = t.decisions.length
    ? t.decisions.map(dec => (
        `<div class="decision-row">
           <div><strong>${escapeHtml(dec.title)}</strong><div class="muted" style="font-size:11px">${escapeHtml(dec.rationale)}</div></div>
           <div class="${dec.status==='Accepted'?'success':(dec.status==='Pending'?'warn':'danger')}">${escapeHtml(dec.status)}</div>
         </div>`
      )).join("")
    : `<div class="muted">No decisions yet.</div>`;

  lensQuestions.innerHTML = t.questions.length
    ? t.questions.map(q => (
        `<div class="question-row">
           <div>${escapeHtml(q.prompt)}</div>
           <div class="${q.status==='Open'?'warn':'success'}">${escapeHtml(q.status)}</div>
         </div>`
      )).join("")
    : `<div class="muted">No open questions.</div>`;
}

function renderPulse(){
  pulseList.innerHTML = `
    <li>${weekPulse.decisions} decisions logged</li>
    <li>${weekPulse.answered} open questions answered</li>
    <li>${weekPulse.revived} threads revived</li>
  `;
}

function renderSlots(items=[]){
  slots.innerHTML = "";
  items.forEach(s=>{
    const div = document.createElement("div"); div.className="slot";
    div.innerHTML = `<strong>${s.when}</strong><div class="muted">${s.participants.join(", ")}</div>`;
    slots.appendChild(div);
  });
}

function renderDrafts(){
  docDraftsEl.innerHTML = "";
  docDrafts.slice().reverse().forEach(d=>{
    const div = document.createElement("div"); div.className="slot";
    div.innerHTML = `<strong>${escapeHtml(d.title)}</strong><div class="muted">${escapeHtml(d.location)}</div>`;
    docDraftsEl.appendChild(div);
  });
}

function renderLedger(){
  ledgerEl.innerHTML = "";
  ledger.slice().reverse().forEach(l=>{
    const div = document.createElement("div"); div.className="ledger-item";
    div.innerHTML = `[${l.time}] ${escapeHtml(l.text)}`;
    ledgerEl.appendChild(div);
  });
}

/* ---------- Helpers ---------- */
function currentThread(){ return threads.find(t=>t.id===selectedThreadId) || null; }
function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }
function now(){ return new Date().toLocaleTimeString(); }
function logLedger(text){ ledger.push({ time: now(), text }); renderLedger(); }
function log(msg){
  console.log(`[${now()}] ${msg}`);
}
function showToast(t){
  console.log(`Toast: ${t}`);
}

/* ---------- Actions ---------- */
function selectThread(id){
  selectedThreadId = id;
  renderThread();
  renderFeed(`Selected thread: ${currentThread().title}`);
}

function attachPack(packId){
  const t = currentThread(); if(!t){ alert("Select a thread first."); return; }
  if(!t.packs.includes(packId)) t.packs.push(packId);
  renderThread();
  renderFeed(`Attached ${packs.find(p=>p.id===packId).name} to “${t.title}”.`);
  logLedger(`PACK_ATTACH: ${packs.find(p=>p.id===packId).name} -> ${t.title}`);
  
  // Immediate effect: seed a synthesis stub
  if(!t.synthesis){
    t.synthesis = "Initial synthesis created by council: purpose clarified, next questions identified.";
    renderThread();
  }
}

// EVENTS

document.getElementById("newThreadBtn").addEventListener("click", ()=>{
  const title = prompt("Thread title?");
  if(!title) return;
  const id = "t" + (threads.length+1);
  threads.unshift({ id, title, tags:["General"], packs:[], dialogue:[], synthesis:"", decisions:[], questions:[] });
  renderThreads();
  selectThread(id);
  renderFeed(`New thread created: ${title}`);
});

document.getElementById("sendBtn").addEventListener("click", ()=>{
  const t = currentThread(); if(!t){ alert("Select a thread first."); return; }
  const text = userInput.value.trim(); if(!text) return;
  userInput.value = "";
  t.dialogue.push({ author:"You", text });
  // council response (mock)
  const response = `Council acknowledges. Extracted key point and updated Synthesis, Decisions, or Questions as needed.`;
  councilOutput.textContent = response;
  // simple extraction demo
  if(text.endsWith("?")){
    t.questions.push({ prompt: text, status:"Open" });
  } else if(/^(decide|decision|approve)/i.test(text)){
    t.decisions.push({ title:"Decision: " + text.slice(0,60), rationale:"Proposed in dialogue", status:"Pending" });
  } else {
    t.synthesis = (t.synthesis ? t.synthesis + " " : "") + "New insight integrated.";
  }
  renderThread();
});

document.getElementById("pulseBtn").addEventListener("click", ()=>{
  const t = currentThread(); if(!t){ alert("Select a thread first."); return; }
  // Pulse composes a rolling summary
  t.synthesis = `Pulse — ${t.title}: ${t.dialogue.length} messages; ${t.decisions.length} decisions; ${t.questions.filter(q=>q.status==='Open').length} questions open.`;
  councilOutput.textContent = "Pulse emitted. Synthesis updated.";
  weekPulse.decisions += t.decisions.length ? 1 : 0;
  renderPulse(); renderThread();
  logLedger(`PULSE_EMIT: ${t.title}`);
});

document.getElementById("proposeMeetingBtn").addEventListener("click", ()=>{
  const t = currentThread(); if(!t){ alert("Select a thread first."); return; }
  const proposed = [
    { when:"Tue 10:00–10:30", participants:["Luc","Team Alpha"] },
    { when:"Wed 14:00–14:30", participants:["Luc","Ethics Committee"] },
    { when:"Fri 09:00–09:30", participants:["Luc","Green Team"] },
  ];
  renderSlots(proposed);
  councilOutput.textContent = "Scheduler proposes three windows. Approve in calendar when ready.";
  logLedger(`SCHEDULER_PROPOSE: 3 slots for ${t.title}`);
});

document.getElementById("draftDocBtn").addEventListener("click", ()=>{
  const t = currentThread(); if(!t){ alert("Select a thread first."); return; }
  const title = `Draft: ${t.title} — Summary v1`;
  const location = "Notion (mock) · /spaces/DYNAMO/Docs";
  docDrafts.push({ title, location });
  renderDrafts();
  councilOutput.textContent = "Draft created from Synthesis. See Doc Drafts.";
  logLedger(`DOC_DRAFT: ${title}`);
});

document.getElementById('showAllCommsBtn').addEventListener('click', ()=>{
  log('Go To DYNAMO Council Chat clicked');
  showToast('Opening Council Chat...');
  // navigate to index.html
  window.location.href = "../";
});

document.getElementById("reviveBtn").addEventListener("click", ()=>{
  const t = currentThread(); if(!t){ alert("Select a thread first."); return; }
  // Revive: promote first open question back to top
  const q = t.questions.find(x=>x.status==="Open");
  if(q){
    t.dialogue.push({ author:"Facilitator", text:`Revive: addressing open question — ${q.prompt}` });
    weekPulse.revived += 1; renderPulse();
    councilOutput.textContent = "Thread revived via open question.";
    renderThread();
    logLedger(`REVIVE: ${t.title} (question resurfaced)`);
  } else {
    councilOutput.textContent = "No open questions to revive. Consider adding one.";
  }
});

/* ---------- Tabs ---------- */
document.querySelectorAll(".tab").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
    document.querySelectorAll(".lens").forEach(l=>l.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById("lens-"+btn.dataset.lens).classList.add("active");
  });
});

/* ---------- Init ---------- */
function init(){
  renderThreads();
  renderPacks();
  renderPulse();
  renderSlots();
  renderDrafts();
  renderLedger();
  // auto-select first thread
  if(threads.length){ selectThread(threads[0].id); }
}
init();
</script>
</body>
</html>
