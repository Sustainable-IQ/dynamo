<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DYNAMO Community Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-left">
            <a href="#" class="dynamo-logo">DYNAMO</a>
            <div class="workspace-selector">
                <select id="workspaceSelect">
                    <option value="ws1">Default Workspace</option>
                </select>
            </div>
            <div class="project-selector">
                <select id="projectSelect">
                    <option value="">Select Project...</option>
                </select>
            </div>
            <button class="btn btn-primary btn-small" id="createProjectBtn" style="margin-left: 8px;">+ New Project</button>
        </div>
        <div class="nav-center">
            <h2 class="tagline">Community Intelligence Console</h2>
        </div>
        <div class="nav-right">
            <button class="btn-icon" id="helpBtn" title="Help & Commands">?</button>
            <button class="btn-icon" id="settingsBtn" title="Settings">⚙</button>
            <button class="login-btn" id="userMenuBtn">User Menu</button>
        </div>
    </nav>

    <!-- Main Application Grid -->
    <div class="app-container">
        <!-- LEFT PANEL: Navigation & Context -->
        <aside class="left-panel panel">
            <section class="panel-section">
                <h3 class="section-title">Project Navigator</h3>
                <button class="btn btn-small" id="deleteProjectBtn" style="background: #f79090; color: white; border: none; margin-bottom: 12px; width: fit-content;">Delete Project</button>
                <div id="projectNav" class="project-nav">
                    <p class="empty-state">Select a project from the top menu</p>
                </div>
            </section>

            <div class="divider"></div>

            <!-- ADD THIS NEW SECTION -->
            <section class="panel-section">
                <h3 class="section-title">Project Workflow</h3>
                <div id="workflowTracker" class="workflow-tracker-container">
                    <p class="empty-state">No workflow defined</p>
                </div>
            </section>

            <div class="divider"></div>

            <section class="panel-section">
                <h3 class="section-title">Agent Pack Library</h3>
                <div id="packLibrary" class="pack-library">
                    <p class="empty-state">No packs available</p>
                </div>
            </section>

            <div class="divider"></div>

            <section class="panel-section">
                <h3 class="section-title">Threads</h3>
                <button class="btn btn-primary btn-small" id="newThreadBtn">+ New Thread</button>
                <div id="threadList" class="thread-list">
                    <p class="empty-state">No threads yet</p>
                </div>
            </section>
        </aside>

        <!-- CENTER PANEL: Living Thread Workspace -->
        <main class="center-panel panel">
            <div class="thread-header">
                <div class="thread-info">
                    <h2 id="threadTitle" class="thread-title">Select a thread</h2>
                    <div id="threadMeta" class="thread-meta">
                        <span class="meta-item">No thread selected</span>
                    </div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 8px; align-items: flex-end;">
                    <button class="btn btn-small" id="deleteThreadBtn" style="background: #ffa2a2; color: white; border: none;">Delete Thread</button>
                    <div class="lens-tabs" role="tablist">
                        <button class="tab active" data-lens="dialogue" role="tab">Dialogue</button>
                        <button class="tab" data-lens="synthesis" role="tab">Synthesis</button>
                        <button class="tab" data-lens="decisions" role="tab">Decisions</button>
                        <button class="tab" data-lens="questions" role="tab">Questions</button>
                    </div>
                </div>
            </div>

            <!-- Lens Views -->
            <div class="lens-container">
                <div id="lensDialogue" class="lens active" role="tabpanel">
                    <p class="empty-state">No messages yet</p>
                </div>
                <div id="lensSynthesis" class="lens" role="tabpanel">
                    <p class="empty-state">No synthesis available</p>
                </div>
                <div id="lensDecisions" class="lens" role="tabpanel">
                    <p class="empty-state">No decisions yet</p>
                </div>
                <div id="lensQuestions" class="lens" role="tabpanel">
                    <p class="empty-state">No questions yet</p>
                </div>
            </div>

            <!-- Two-Lane Composer -->
            <div class="composer-container">
                <div class="composer-header">
                    <div class="lane-toggle">
                        <button class="lane-btn active" data-lane="human">Human Lane</button>
                        <button class="lane-btn" data-lane="agent">Agent Lane</button>
                    </div>
                    <div class="composer-info">
                        <span id="composerMode" class="mode-indicator">Human Communication</span>
                    </div>
                </div>

                <!-- Human Lane -->
                <div id="humanLane" class="composer-lane active">
                    <textarea 
                        id="humanInput" 
                        placeholder="Type your message to the team..."
                        rows="3"
                    ></textarea>
                    <div class="composer-actions">
                        <button class="btn btn-primary" id="sendHumanBtn">Send Message</button>
                    </div>
                </div>

                <!-- Agent Lane -->
                <div id="agentLane" class="composer-lane">
                    <div class="command-input-container">
                        <input 
                            type="text" 
                            id="commandInput" 
                            placeholder="Type / to see available commands..."
                            autocomplete="off"
                        />
                        <div id="commandAutocomplete" class="command-autocomplete hidden"></div>
                    </div>
                    <div id="commandForm" class="command-form hidden">
                        <!-- Dynamic command form will appear here -->
                    </div>
                    <div class="composer-actions">
                        <button class="btn btn-secondary" id="cancelCommandBtn">Cancel</button>
                        <button class="btn btn-primary" id="submitCommandBtn" disabled>Submit Command</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- RIGHT PANEL: Artefacts & Audit -->
        <aside class="right-panel panel">
            <!-- GO TO COUNCIL CHAT BUTTON -->
            <section class="panel-section">
                <div style="display: flex; justify-content: flex-end;">
                    <button class="btn" id="showAllCommsBtn" style="background:#06b6d4;color:white;border:none;padding:8px 12px;width:fit-content;font-weight:normal;">
                        Go To DYNAMO Council Chat
                    </button>
                </div>
            </section>

            <div class="divider"></div>

            <section class="panel-section">
                <h3 class="section-title">Active Agent Pack</h3>
                <div id="activePackInfo" class="active-pack-info">
                    <p class="empty-state">No pack active</p>
                </div>
            </section>

            <div class="divider"></div>

            <section class="panel-section">
                <h3 class="section-title">Artefacts</h3>
                <div id="artefactsList" class="artefacts-list">
                    <p class="empty-state">No artefacts yet</p>
                </div>
            </section>

            <div class="divider"></div>

            <section class="panel-section collapsible">
                <div class="section-header" id="ledgerHeader">
                    <h3 class="section-title">Action Ledger</h3>
                    <button class="collapse-btn">▼</button>
                </div>
                <div id="actionLedger" class="action-ledger">
                    <p class="empty-state">No actions logged</p>
                </div>
            </section>
        </aside>
    </div>

    <!-- Modals (initially hidden) -->
    <div id="modalOverlay" class="modal-overlay hidden"></div>
    
    <!-- Help Modal -->
    <div id="helpModal" class="modal hidden">
        <div class="modal-header">
            <h2>Command Reference</h2>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <p>Help content will load here...</p>
        </div>
    </div>

    <!-- Audit Trail Modal -->
    <div id="auditModal" class="modal hidden">
        <div class="modal-header">
            <h2>Audit Trail</h2>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body" id="auditModalBody">
            <p>Audit details will load here...</p>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div id="createProjectModal" class="modal hidden">
        <div class="modal-header">
            <h2>Create New Project</h2>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 20px;">
                <label for="projectNameInput" style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Name of Project</label>
                <input type="text" id="projectNameInput" placeholder="Enter project name..." style="width: 100%; background: var(--bg-tertiary); border: 1px solid var(--border-normal); color: var(--text-primary); padding: 10px; border-radius: var(--radius-md); font-family: var(--font-sans); font-size: 14px;">
            </div>
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: 12px; color: var(--text-primary);">Select Team Members</label>
                <div id="userCheckboxList" style="display: flex; flex-direction: column; gap: 10px; max-height: 200px; overflow-y: auto; padding: 12px; background: var(--overlay-light); border: 1px solid var(--border-subtle); border-radius: var(--radius-md);">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--text-primary);">
                        <input type="checkbox" name="projectUser" value="user_sarah" style="width: 18px; height: 18px; cursor: pointer;">
                        <span>Sarah Chen</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--text-primary);">
                        <input type="checkbox" name="projectUser" value="user_mike" style="width: 18px; height: 18px; cursor: pointer;">
                        <span>Mike Torres</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--text-primary);">
                        <input type="checkbox" name="projectUser" value="user_jessica" style="width: 18px; height: 18px; cursor: pointer;">
                        <span>Jessica Park</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; color: var(--text-primary);">
                        <input type="checkbox" name="projectUser" value="user_marcus" style="width: 18px; height: 18px; cursor: pointer;">
                        <span>Marcus Wu</span>
                    </label>
                </div>
            </div>
            <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                <button class="btn btn-primary" id="createProjectNextBtn">Next</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/mockData.js"></script>
    <script src="js/state.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
