<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DYNAMO Mock Demo Prototype (v0.2)</title>
<style>
  :root{
    --bg:#0a1020; --muted:#a9b4c3; --accent:#7c3aed; --accent-2:#4f46e5; --success:#10b981; --warn:#f59e0b;
    --left-1:#0a1c2d; --left-2:#0b1526;  /* LEFT panel gradient */
    --right-1:#150f2d; --right-2:#0f1426; /* RIGHT panel gradient */
    --center-1:rgba(255,255,255,0.02); --center-2:rgba(255,255,255,0.01);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{margin:0; background:linear-gradient(180deg,#071024 0%, #081426 60%); color:#e6eef6; min-height:100vh;}
  /* Top navigation bar */
  .top-nav{background:rgba(0,0,0,0.3);padding:12px 26px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.1);}
  .dynamo-logo{font-size:24px;font-weight:900;color:#fbbf24;letter-spacing:1px;text-decoration:none;cursor:pointer;}
  .dynamo-logo:hover{color:#fcd34d;}
  .tagline{font-size:20px;color:#ffffff;font-weight:600;position:absolute;left:50%;transform:translateX(-50%);animation:heartbeat 6s ease-in-out infinite;}
  @keyframes heartbeat {
    0% { transform: translateX(-50%) scale(1); }
    14% { transform: translateX(-50%) scale(1.05); }
    28% { transform: translateX(-50%) scale(1); }
    42% { transform: translateX(-50%) scale(1.05); }
    70% { transform: translateX(-50%) scale(1); }
  }
  .login-btn{background:transparent;border:1px solid rgba(255,255,255,0.2);padding:8px 16px;border-radius:6px;color:#e6eef6;cursor:pointer;font-weight:600;font-size:14px;transition:all 0.3s;}
  .login-btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.3);}
  .app{
    display:grid;
    grid-template-columns: 300px 1.8fr 300px; /* give the center more space */
    gap:18px; padding:26px; max-width:1600px; margin:0 auto;
  }
  .panel{border-radius:14px; padding:18px; box-shadow: 0 6px 24px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.05);}
  .left{height:86vh; overflow:hidden; background:linear-gradient(180deg,var(--left-1),var(--left-2)); display:flex; flex-direction:column;}
  .right{height:86vh; overflow:auto; background:linear-gradient(180deg,var(--right-1),var(--right-2));}
  .center{
    height:86vh; display:flex; flex-direction:column; gap:12px; overflow:hidden;
    background:linear-gradient(180deg, var(--center-1), var(--center-2));
  }
  h2{margin:6px 0 6px 0; font-size:18px; color:#eef2ff;}
  .section-title{font-size:12px; letter-spacing:.2px; color:var(--muted); margin-bottom:6px; text-transform:uppercase;}
  .btn{background:transparent; border:1px solid rgba(255,255,255,0.10); padding:10px 12px; border-radius:10px; cursor:pointer; color:#dbeafe;}
  .btn.primary{background:linear-gradient(90deg,var(--accent), var(--accent-2)); box-shadow:0 8px 18px rgba(124,58,237,0.28); border:none;}
  .meta{font-size:12px; color:var(--muted);}
  .hr{border:none;height:1px;background:rgba(255,255,255,0.06);margin:12px 0;}
  /* Memory list */
  .memory-list-container{height:360px; overflow-y:auto; overflow-x:hidden; padding-right:8px; margin-bottom:12px;}
  .memory-list-container::-webkit-scrollbar{width:6px;}
  .memory-list-container::-webkit-scrollbar-track{background:rgba(255,255,255,0.05); border-radius:3px;}
  .memory-list-container::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.2); border-radius:3px;}
  .memory-list-container::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.3);}
  .memory-item{background:rgba(255,255,255,0.03); padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); cursor:pointer; transition:all 0.2s ease;}
  .memory-item:hover{background:rgba(255,255,255,0.05);}
  .memory-item.selected{background:rgba(124,58,237,0.25); border:2px solid rgba(124,58,237,0.6); box-shadow:0 0 12px rgba(124,58,237,0.3);}
  .memory-item h4{margin:0; font-size:13px;}
  .memory-item p{margin:4px 0 0;color:var(--muted);font-size:12px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;line-clamp:2}
 
 
  /* Right AI-Agent rows */
  .ai-agent-row{display:flex; justify-content:space-between; gap:8px; align-items:center; padding:10px; border-radius:10px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06);}
  /* CHAT-FOCUSED CENTER */
  .header{
    display:flex; justify-content:space-between; align-items:center; padding:6px 10px 0 10px;
  }
  .model-badge{font-size:12px; color:var(--muted);}
  .chat{
    display:flex; flex-direction:column; gap:12px; flex:1; overflow:auto; padding:0 10px 8px 10px;
    border-radius:12px; border:1px solid rgba(255,255,255,0.05);
    background:linear-gradient(180deg, rgba(124,58,237,0.05), rgba(124,58,237,0.03) 30%, rgba(255,255,255,0.02) 100%);
  }
  .msg{max-width:900px; line-height:1.5; font-size:14px;}
  .msg.user{align-self:flex-end; text-align:right;}
  .msg.assistant{align-self:flex-start;}
  .bubble{padding:0; }
  .ai-agent-strip{display:flex; gap:8px; flex-wrap:wrap; font-size:12px; color:var(--muted);}
  .ai-agent-pill{padding:6px 8px; border-radius:999px; border:1px solid rgba(255,255,255,0.10); background:rgba(255,255,255,0.03);}
  .input-wrap{
    position:sticky; bottom:0; left:0; right:0; background:linear-gradient(180deg, transparent, rgba(10,16,32,0.8) 38%);
    padding:10px 10px 2px 10px;
  }
  .input-row{display:flex; gap:8px; }
  .input-row textarea{flex:1; padding:12px 12px; border-radius:12px; background:transparent; border:1px solid rgba(255,255,255,0.12); color:#e6eef6; min-height:52px; resize:vertical;}
  .input-row button{padding:12px 16px; border-radius:12px; border:none; cursor:pointer; font-weight:600;}
  .subbar{display:flex; justify-content:space-between; align-items:center; padding:6px 2px 0 2px; font-size:12px; color:var(--muted);}
  .ring{display:inline-block; width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 10px rgba(124,58,237,.6); margin-right:6px;}
  .toast{position:fixed; right:26px; bottom:26px; background:#07122a; padding:12px 16px; border-radius:10px; border:1px solid rgba(255,255,255,0.10); display:none;}
  /* Modal styles */
  .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;}
  .modal-content{background:linear-gradient(180deg,#0a1c2d,#0b1526);border-radius:14px;padding:24px;width:700px;border:1px solid rgba(255,255,255,0.1);box-shadow:0 10px 30px rgba(0,0,0,0.5);}
  .modal-content h3{margin:0 0 16px 0;color:#eef2ff;font-size:18px;}
  .modal-content label{display:block;margin-bottom:8px;color:var(--muted);font-size:14px;}
  .modal-content input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:#e6eef6;font-size:14px;margin-bottom:20px;}
  .modal-content input::placeholder{color:#888;}
  .modal-content select{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:#e6eef6;font-size:14px;margin-bottom:16px;cursor:pointer;}
  .modal-content select option{background:#0a1c2d;color:#e6eef6;}
  .modal-buttons{display:flex;gap:12px;justify-content:flex-end;}
  .modal-send{background:#06b6d4;color:white;padding:10px 20px;border-radius:8px;border:none;cursor:pointer;font-weight:600;}
  .modal-cancel{background:rgba(255,255,255,0.1);color:var(--muted);padding:10px 20px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);cursor:pointer;}
  /* Gauge styles */
  .gauge-section{display:flex;flex-direction:column;margin-bottom:20px;padding:16px;background:rgba(255,255,255,0.02);border-radius:12px;border:1px solid rgba(255,255,255,0.05);}
  .gauge{display:flex;flex-direction:column;align-items:center;gap:8px;}
  .gauge-container{position:relative;width:60px;height:60px;}
  .gauge-circle{width:60px;height:60px;border-radius:50%;background:conic-gradient(from 0deg, var(--accent) 0%, var(--accent) var(--gauge-percent), rgba(255,255,255,0.1) var(--gauge-percent), rgba(255,255,255,0.1) 100%);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:11px;}
  .gauge-label{font-size:12px;font-weight:700;color:var(--muted);text-align:center;line-height:1.2;max-width:80px;position:relative;}
  .gauge-label .help-icon-info{color:#888;cursor:pointer;font-size:8px;margin-left:2px;}
  .gauge-label .help-icon-info .tooltip{position:absolute;bottom:25px;left:50%;transform:translateX(-50%);background:#1a202c;color:#fff;padding:6px 10px;border-radius:6px;font-size:10px;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity 0.3s;z-index:1000;max-width:200px;white-space:normal;width:max-content;}
  .gauge-label .help-icon-info:hover .tooltip{opacity:1;visibility:visible;}
  /* Status buttons and toggle styles */
  .status-buttons{display:flex;justify-content:space-between;align-items:center;padding:8px 10px 0 10px;}
  .status-left{display:flex;gap:8px;}
  .status-btn{padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-size:12px;}
  .status-btn.resolved{background:#065f46;color:#a7f3d0;}
  .status-btn.unresolved{background:#F59E0B;color:white;}
  .status-btn.dismiss{background:#7f1d1d;color:#fca5a5;}
  .status-btn.community{background:#06b6d4;color:white;}
  .toggle-container{display:flex;gap:24px;justify-content:flex-start;flex-wrap:wrap;}
  .bypass-section{display:flex;align-items:center;gap:8px;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.05);}
  .toggle-switch{position:relative;display:inline-block;width:44px;height:24px;}
  .toggle-switch input{opacity:0;width:0;height:0;}
  .toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:rgba(255,255,255,0.2);transition:.4s;border-radius:24px;}
  .toggle-slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:white;transition:.4s;border-radius:50%;}
  input:checked + .toggle-slider{background-color:var(--accent);}
  input:checked + .toggle-slider:before{transform:translateX(20px);}
  .help-icon{cursor:pointer;color:var(--muted);font-size:14px;position:relative;}
  .tooltip{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background:#1a202c;color:#fff;padding:8px 12px;border-radius:6px;font-size:11px;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity 0.3s;z-index:1000;max-width:250px;white-space:normal;width:max-content;}
  .help-icon:hover .tooltip{opacity:1;visibility:visible;}
  /* AI-Agent controls horizontal layout */
  .ai-agent-horizontal{display:flex;gap:12px;justify-content:space-around;margin-bottom:20px;padding:12px 16px;background:rgba(255,255,255,0.02);border-radius:12px;border:1px solid rgba(255,255,255,0.05);flex-wrap:wrap;}
  .ai-agent-item{display:flex;flex-direction:column;align-items:center;gap:6px;min-width:100px;}
  .ai-agent-item .ai-agent-name{font-size:14px;font-weight:700;text-align:center;color:white;}
  .help-icon-info{color:#888;cursor:pointer;font-size:10px;margin-left:2px;position:relative;}
  .help-icon-info .tooltip{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:#1a202c;color:#fff;padding:8px 12px;border-radius:6px;font-size:11px;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity 0.3s;z-index:1000;max-width:250px;white-space:normal;width:max-content;}
  .help-icon-info:hover .tooltip{opacity:1;visibility:visible;}
  .ai-agent-button{padding:6px 12px;border-radius:6px;border:none;font-weight:600;font-size:11px;margin:2px 0;min-width:50px;pointer-events:none;}
  .ai-agent-button.on{background:var(--success);color:white;}
  .ai-agent-button.off{background:#dc2626;color:white;}
  .pill-toggle{position:relative;display:inline-flex;width:70px;height:28px;background:#2a2a2a;border-radius:14px;margin-top:4px;}
  .pill-toggle .toggle-input{position:absolute;opacity:0;width:0;height:0;}
  .pill-toggle .toggle-label{position:relative;display:flex;align-items:center;justify-content:center;width:50%;height:100%;font-size:10px;font-weight:600;cursor:pointer;transition:color 0.3s ease;z-index:2;}
  .pill-toggle .toggle-slider{position:absolute;top:0;left:0;width:50%;height:100%;background:#444;border-radius:14px;transition:transform 0.3s ease;z-index:1;}
  .pill-toggle input[id^="on-"]:checked ~ .toggle-slider{transform:translateX(0);}
  .pill-toggle input[id^="off-"]:checked ~ .toggle-slider{transform:translateX(100%);}
  .pill-toggle input[id^="on-"]:checked ~ label[for^="on-"]{color:white;}
  .pill-toggle input[id^="on-"]:checked ~ label[for^="off-"]{color:#888;}
  .pill-toggle input[id^="off-"]:checked ~ label[for^="off-"]{color:white;}
  .pill-toggle input[id^="off-"]:checked ~ label[for^="on-"]{color:#888;}
  .ai-agent-item .ai-agent-value{font-size:10px;color:var(--muted);}
  
    /* Global divider style */
  hr {
    border: none;
    height: 1px;
    background: rgba(255, 255, 255, 0.23);
    margin: 12px 0;
  }
  
  /* Community projects */
  .community-item{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);margin-bottom:8px;}
  .community-item h4{margin:0;font-size:12px;color:#eef2ff;}
  .community-item p{margin:4px 0 0 0;color:var(--muted);font-size:11px;line-height:1.3;}
  @media (max-width:1100px){
    .app{grid-template-columns: 1fr; padding:12px}
    .left,.right{height:auto}
    .center{height:82vh}
    .gauge-section{flex-wrap:wrap;gap:12px;}
    .gauge{min-width:70px;}
  }
</style>
</head>
<body>
<!-- TOP NAVIGATION BAR -->
<div class="top-nav">
  <a href="https://dynamo-ai.tech/" class="dynamo-logo" target="_blank">DYNAMO - Mock Demo</a>
  <div class="tagline">The Dynamic AI Memory Organizer Platform</div>
  <button class="login-btn" id="loginBtn">LOG IN</button>
</div>

<div class="app">
  <!-- GAUGE SECTION -->
  <div style="grid-column: 1 / -1;">
    <div class="gauge-section">
      <h3 style="margin:0 0 16px 0;font-size:16px;color:#eef2ff;text-align:center;width:100%;">DYNAMO USAGE</h3>
      <div style="display:flex;gap:20px;justify-content:space-around;flex-wrap:wrap;">
        <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="llmGauge" style="--gauge-percent: 75%;">75%</div>
        </div>
        <div class="gauge-label">
          External LLM Usage
          <sup class="help-icon-info">i
            <div class="tooltip">Tracks percentage of monthly external API budget consumed.</div>
          </sup>
        </div>
      </div>
      <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="tokensGauge" style="--gauge-percent: 42%;">42%</div>
        </div>
        <div class="gauge-label">
          Context Window – Tokens Left
          <sup class="help-icon-info">i
            <div class="tooltip">Shows percentage of tokens remaining in the current model's context window.</div>
          </sup>
        </div>
      </div>
      <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="personalMemoryGauge" style="--gauge-percent: 68%;">34GB</div>
        </div>
        <div class="gauge-label">
          Personal Memory Usage
          <sup class="help-icon-info">i
            <div class="tooltip">Measures private storage consumption for personal data and embeddings.</div>
          </sup>
        </div>
      </div>
      <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="communityMemoryGauge" style="--gauge-percent: 56%;">56GB</div>
        </div>
        <div class="gauge-label">
          Community Memory Usage
          <sup class="help-icon-info">i
            <div class="tooltip">Indicates shared/community storage consumption.</div>
          </sup>
        </div>
      </div>
      <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="communityActionsGauge" style="--gauge-percent: 23%;">23%</div>
        </div>
        <div class="gauge-label">
          Community Actions
          <sup class="help-icon-info">i
            <div class="tooltip">Counts metered actions performed in community spaces (e.g., emails sent, calendar invitations, notes created).</div>
          </sup>
        </div>
      </div>
      </div>
    </div>
  </div>

  <!-- AI-AGENT CONTROLS HORIZONTAL -->
  <div class="ai-agent-horizontal" style="grid-column: 1 / -1;">
    <div style="width:100%;margin-bottom:12px;">
      <h3 style="margin:0 0 12px 0;font-size:16px;color:#eef2ff;text-align:center;">THE COUNCIL : AI-AGENTS</h3>
    </div>
    <div id="aiAgentHorizontalControls" style="display:flex;gap:16px;justify-content:space-around;width:100%;flex-wrap:wrap;"></div>
  </div>

  <!-- LEFT: distinct teal/blue gradient -->
  <div class="panel left">
    <h2>Dynamo Memories</h2>
    <hr>
    <button class="btn" id="showMemoryConsoleBtn" style="background:#06b6d4;color:white;border:none;width:fit-content;display:inline-block;">Go To Memory Console</button>
    <hr>
    <div class="section-title">Recent Threads</div>
    <div class="memory-list-container">
      <div id="memoryList" style="display:flex;flex-direction:column;gap:10px"></div>
    </div>
    <button class="btn primary" id="addToChatBtn">Add to Chat</button>
    <div style="flex-grow:1;"></div>
    <div class="hr"></div>
    <div>
      <div class="section-title">Account</div>
      <div style="display:flex;gap:8px;align-items:center;">
        <div style="width:32px;height:32px;border-radius:8px;background:linear-gradient(90deg,#22d3ee,#7c3aed);display:grid;place-items:center;font-weight:600;font-size:14px;">L</div>
        <div>
          <div style="font-weight:600;font-size:14px;">Luc</div>
          <div style="font-size:11px;color:var(--muted)">Demo account</div>
        </div>
      </div>
    </div>
  </div>

  <!-- CENTER: chat-first layout with scrollable answers -->
  <div class="panel center">
    <div class="header">
      <div>
        <div class="section-title">Main Council Interface</div>
        <div style="font-size:18px;font-weight:700">DYNAMO Council Chat</div>
      </div>
      <div class="model-badge">
        <sup class="help-icon-info" style="position:relative;" onmouseover="this.children[0].style.opacity='1';this.children[0].style.visibility='visible';" onmouseout="this.children[0].style.opacity='0';this.children[0].style.visibility='hidden';">1
          <div style="position:absolute;top:20px;left:-150px;background:#1a202c;color:#fff;padding:8px 12px;border-radius:6px;font-size:11px;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity 0.3s;z-index:1000;max-width:250px;white-space:normal;width:max-content;">The model and variant will be updated in the LIVE version of DYNAMO</div>
        </sup>
        External LLM:
        <select id="llmSelect" style="background:rgba(10,16,32,0.9);border:1px solid rgba(255,255,255,0.2);color:#e6eef6;padding:2px 6px;border-radius:4px;font-size:12px;cursor:pointer;">
          <option value="ChatGPT" style="background:#0a1020;color:#e6eef6;">ChatGPT</option>
          <option value="Claude" style="background:#0a1020;color:#e6eef6;">Claude</option>
          <option value="Gemini" style="background:#0a1020;color:#e6eef6;">Gemini</option>
          <option value="Grok" style="background:#0a1020;color:#e6eef6;">Grok</option>
        </select>
      </div>
    </div>

    <div class="chat" id="chatLog">
      <!-- seeded content -->
    </div>

    <div class="input-wrap">
      <div class="toggle-container">
        <div class="bypass-section">
          <span style="font-size:12px;color:var(--muted);">Bypass External LLM</span>
          <label class="toggle-switch">
            <input type="checkbox" id="bypassToggle">
            <span class="toggle-slider"></span>
          </label>
          <span class="help-icon">?
            <div class="tooltip">If toggled ON, DYNAMO will only use local LLMs instead of including an external LLM. This will eliminate API call fees.</div>
          </span>
        </div>
        <div class="bypass-section">
          <span style="font-size:12px;color:var(--muted);">Bypass Council</span>
          <label class="toggle-switch">
            <input type="checkbox" id="bypassCouncilToggle">
            <span class="toggle-slider"></span>
          </label>
          <span class="help-icon">?
            <div class="tooltip">If toggled ON, the Dynamo Council will not participate in formulating the response. Instead, the reply will come solely from the external LLM (e.g., Claude, ChatGPT, Grok, etc.), just like a standard browser chat with a LLM.</div>
          </span>
        </div>
      </div>
      <div class="input-row">
        <textarea id="userQuestion" placeholder="Ask the Council..."></textarea>
        <button class="btn primary" id="askBtn">Ask</button>
        <button class="btn" id="newConversationBtn" style="background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);">Start a New Conversation</button>
      </div>
      <div class="subbar">
        <div><span class="ring"></span><span id="statusLine">Idle</span></div>
        <div class="ai-agent-strip" id="aiAgentStrip"></div>
      </div>
      <div class="status-buttons">
        <div class="status-left">
          <button class="status-btn resolved" id="resolvedBtn">Resolved</button>
          <button class="status-btn unresolved" id="unresolvedBtn">Unresolved</button>
          <button class="status-btn dismiss" id="dismissBtn">Dismiss</button>
        </div>
        <button class="status-btn community" id="sendToCommunityBtn">Send To Community</button>
      </div>
    </div>
  </div>

  <!-- RIGHT: distinct purple/indigo gradient -->
  <div class="panel right">
    <h2>Dynamo Community</h2>
    <hr>
    <button class="btn" id="showAllCommsBtn" style="background:#06b6d4;color:white;border:none;width:fit-content;display:inline-block;">Go To Community Console</button>
    <hr>
    <div class="section-title">Recent Community Projects</div>
    <div id="communityProjects" style="display:flex;flex-direction:column;gap:8px;margin-bottom:12px;"></div>
    <hr>
    <div class="section-title"><strong>Recent Community Actions</strong></div>
    <div id="communityActions" style="font-size:12px;color:var(--muted);margin-bottom:12px;">
      <div style="margin-bottom:6px;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;border:1px solid rgba(255,255,255,0.06);">ACME v. Northwind: Research Completed - File motion to transfer venue to Eastern District of Texas</div>
      <div style="margin-bottom:6px;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;border:1px solid rgba(255,255,255,0.06);">Mobile Banking App Redesign: Commit to 16-point Sprint 1 with onboarding focus - ACCEPTED</div>
    </div>
    <div class="section-title">Session Log</div>
    <div id="logArea" style="font-size:12px;color:var(--muted);max-height:240px;overflow:auto;padding-right:6px;"></div>
  </div>
</div>

<div class="toast" id="toast">Saved</div>

<div class="modal-overlay" id="welcomeModal" style="display:flex;">
  <div class="modal-content">
    <h3 style="margin-bottom: 20px; color: #fbbf24;">Welcome to the DYNAMO Mock Demo</h3>
    
    <p style="margin-bottom: 16px;">This is an illustrative demo only. Please note the following before exploring:</p>
    <ul style="margin: 16px 0 20px 0; padding-left: 20px; color: #e6eef6;">
      <li style="margin-bottom: 8px;">No live AI LLMs are running — all responses, interactions, and council activity are simulated</li>
      <li style="margin-bottom: 8px;">Pre-seeded sample data is included to show how the system might look in use</li>
      <li style="margin-bottom: 8px;">Buttons, sliders, and text inputs work, but outputs are for demonstration purposes only</li>
      <li style="margin-bottom: 8px;">Nothing you enter is saved — your input will not persist beyond this session</li>
      <li style="margin-bottom: 8px;">Not all features are animated or interactive, some panels are placeholders for future functionality</li>
    </ul>
    
    <p style="margin-bottom: 20px;">To learn more about DYNAMO go to: <a href="https://dynamo-ai.tech/" target="_blank" style="color: #06b6d4; text-decoration: underline;">https://dynamo-ai.tech/</a></p>
    
    <div class="modal-buttons">
      <button class="btn modal-send" id="welcomeCloseBtn">Enter DYNAMO</button>
    </div>
  </div>
</div>

<!-- Community Thread Modal -->
<div class="modal-overlay" id="communityModal" style="display:none;">
  <div class="modal-content">
    <h3>Send to Community</h3>
    <label for="threadSelect">Select an Active Community Thread</label>
    <select id="threadSelect">
      <option value="">-- Select a thread --</option>
    </select>
    <label for="threadNameInput">Or Type a Custom Thread Name</label>
    <input type="text" id="threadNameInput" placeholder="(e.g., Community Garden: irrigation plan)">
    <div class="modal-buttons">
      <button class="btn modal-send" id="modalSendBtn">Send</button>
      <button class="btn modal-cancel" id="modalCancelBtn">Cancel</button>
    </div>
  </div>
</div>

<script>
  // Demo data
  const gauges = [
    {id: 'llmGauge', label: 'External LLM Usage', value: 75, max: 100, unit: '%', description: 'Tracks percentage of monthly external API budget consumed.'},
    {id: 'tokensGauge', label: 'Context Window – Tokens Left', value: 42, max: 100, unit: '%', description: 'Shows percentage of tokens remaining in the current model\'s context window.'},
    {id: 'personalMemoryGauge', label: 'Personal Memory Usage', value: 34, max: 50, unit: 'GB', description: 'Measures private storage consumption for personal data and embeddings.'},
    {id: 'communityMemoryGauge', label: 'Community Memory Usage', value: 56, max: 100, unit: 'GB', description: 'Indicates shared/community storage consumption.'},
    {id: 'communityActionsGauge', label: 'Community Actions', value: 23, max: 100, unit: '%', description: 'Counts metered actions performed in community spaces (e.g., emails sent, calendar invitations, notes created).'}
  ];

  const aiAgents = [
    {id:"authority",   name:"Authority", symbol:"🛡️", value:70},
    {id:"iconoclast", name:"Iconoclast", symbol:"🔍", value:80},
    {id:"strategist",  name:"Strategist", symbol:"🎯", value:65},
    {id:"archivist",   name:"Archivist", symbol:"⚖️", value:55},
    {id:"secretariat", name:"Secretariat", symbol:"🧠", value:80},
  ];

  // // Define threads data (was missing)
  // const threads = [
  //   {title: "Community Garden Planning", members: 12, activity: "active"},
  //   {title: "Local Food Network", members: 8, activity: "planning"},
  //   {title: "Skill Share Coordination", members: 15, activity: "active"},
  //   {title: "Emergency Preparedness", members: 6, activity: "review"}
  // ];

  let memory = [
{title:"Educational Choice Dilemma", text:"Should I homeschool my children or send them to public school?"},
{title:"Homeschooling Risk Preparation", text:"What are the biggest risks of homeschooling that I should prepare for?"},
{title:"Corporate Spiritual Practice", text:"How can I maintain spiritual practice while working in a corporate environment?"},
{title:"Ethical Work Alignment", text:"Is it hypocritical to work for a company whose values don't align with my spiritual beliefs?"},
{title:"Media Manipulation Detection", text:"How can I tell when news reports are manipulating me versus informing me?"},
{title:"News Source Strategy", text:"Should I just avoid all mainstream news to protect myself from manipulation?"},
{title:"Boundary Setting Without Damage", text:"How do I set boundaries without damaging my relationships?"},
{title:"Boundary Violation Response", text:"What if someone gets angry or guilt-trips me when I try to set boundaries?"},
{title:"Financial Independence Viability", text:"Is financial independence still achievable with inflation destroying savings?"},
{title:"Crypto vs Traditional Assets", text:"Should I invest in cryptocurrency or stick to traditional investments like stocks?"},
{title:"Health Decision Sovereignty", text:"How do I make informed health decisions when I don't trust mainstream medical advice?"},
{title:"Health Research Methodology", text:"What's the most effective way to research health information without getting overwhelmed by conflicting studies?"},
{title:"Digital Surveillance Concerns", text:"How concerned should I be about digital surveillance and privacy?"},
{title:"Essential Privacy Tools", text:"What are the most important privacy tools I should start using immediately?"},
{title:"Artistic Integrity Balance", text:"How do I maintain artistic integrity while needing to make money from creative work?"},
{title:"Social Media Algorithm Adaptation", text:"Should I change my art to fit what's popular on social media platforms?"},
{title:"Community Building Challenge", text:"How do I build meaningful community when everyone seems isolated and busy?"},
{title:"Community Sustainability Factors", text:"What makes some communities last while others fall apart quickly?"},
{title:"Spiritual Progress Assessment", text:"How do I know if I'm making real spiritual progress or just having interesting experiences?"},
{title:"Individual vs Collective Awakening", text:"Should I focus on individual spiritual development or community engagement for awakening?"}
  ];

  // Recent thread content - detailed content for each thread
const recentThreadContent = {
    "Educational Choice Dilemma": "userMessage: Should I homeschool my children or send them to public school? --- councilResponse: The choice between homeschooling and public schooling reflects deeper questions about educational sovereignty and institutional trust. Public schools provide standardized credentials and socialization but often suppress individual curiosity through rigid curricula designed for compliance rather than learning. Homeschooling preserves educational freedom and allows customized learning but requires significant parental investment and intentional community building. Consider your family's capacity for educational leadership, your children's learning styles, and your tolerance for institutional compromise versus personal responsibility.",

    "Homeschooling Risk Preparation": "userMessage: What are the biggest risks of homeschooling that I should prepare for? --- councilResponse: The primary risks include social isolation, gaps in specialized subjects, and parental burnout. Combat isolation by joining homeschool cooperatives, sports teams, and community activities - children need diverse adult mentors and peer relationships. Address subject gaps by networking with other homeschool families, using online resources, or hiring tutors for advanced topics. Prevent burnout by sharing teaching responsibilities with your spouse, taking breaks when needed, and remembering that learning happens everywhere, not just during formal lessons. The biggest long-term risk is actually over-protection - ensure your children face age-appropriate challenges and develop independence.",

    "Corporate Spiritual Practice": "userMessage: How can I maintain spiritual practice while working in a corporate environment? --- councilResponse: Corporate environments often operate through extraction and competition that can conflict with spiritual development, but they also provide laboratories for practicing compassion under pressure. Establish non-negotiable daily practices before and after work hours - meditation, prayer, or journaling that ground you in your values. Use workplace challenges as spiritual curriculum: difficult colleagues become teachers of patience, ethical dilemmas become opportunities for moral clarity. Create subtle ritual anchors throughout your day without drawing attention to yourself.",

    "Ethical Work Alignment": "userMessage: Is it hypocritical to work for a company whose values don't align with my spiritual beliefs? --- councilResponse: Hypocrisy lies in contradiction between stated values and actions, not in working within imperfect systems while maintaining personal integrity. Most people need income to survive, and complete ethical purity in employment is nearly impossible under current economic structures. The key questions are: Can you do your specific role with integrity? Are you actively participating in harm or simply working within a flawed system? Can you use your position to influence positive change, even incrementally? Sometimes working from within corrupt systems while maintaining your values creates more positive impact than pure withdrawal.",

    "Media Manipulation Detection": "userMessage: How can I tell when news reports are manipulating me versus informing me? --- councilResponse: Media manipulation operates through recognizable patterns: emotional amplification without proportional evidence, repetitive messaging across outlets using identical phrases, focus on reactions rather than root causes, omission of historical context, and artificial urgency demanding immediate response. Legitimate information provides multiple viewpoints, acknowledges uncertainty, includes historical precedent, and allows reflection time. Always ask: Who benefits from me believing this? What am I being asked to feel or do? What voices are excluded? What historical patterns does this echo?",

    "News Source Strategy": "userMessage: Should I just avoid all mainstream news to protect myself from manipulation? --- councilResponse: Complete news avoidance creates dangerous blind spots, while exclusive mainstream consumption limits perspective. Develop a diverse information diet: read mainstream sources to understand dominant narratives, follow independent journalists for suppressed perspectives, study historical context to recognize recurring patterns, and maintain direct community connections for local reality checks. The goal isn't finding perfect sources but developing discernment across multiple viewpoints. Spend more time analyzing information patterns than consuming information volume. Quality discernment matters more than information quantity.",

    "Boundary Setting Without Damage": "userMessage: How do I set boundaries without damaging my relationships? --- councilResponse: Healthy boundaries actually strengthen relationships by creating clarity and preventing resentment. Start by being clear about your own needs and limits before communicating them. Frame boundaries in terms of what you can do rather than what others must do: I need to leave by 9 PM rather than You always keep me too late. Expect some pushback initially - people may test new boundaries. Stay consistent and kind but firm. Remember that people who truly care about you want to know your actual limits rather than having you secretly resent them for crossing unknown lines.",

    "Boundary Violation Response": "userMessage: What if someone gets angry or guilt-trips me when I try to set boundaries? --- councilResponse: Anger or guilt-tripping in response to reasonable boundaries reveals that person's investment in controlling or using you rather than having an authentic relationship. This reaction is actually valuable information about their character and intentions. Respond with calm consistency: acknowledge their feelings without changing your boundary. I understand you're disappointed, but this is what I need. Don't argue, justify extensively, or negotiate core boundaries. People who respect you will adjust; those who don't will reveal themselves as unsuitable for close relationship. Short-term conflict often leads to long-term clarity and healthier dynamics.",

    "Financial Independence Viability": "userMessage: Is financial independence still achievable with inflation destroying savings? --- councilResponse: Traditional financial independence through savings alone has been undermined by currency debasement, but alternative strategies remain viable. Focus on inflation-resistant assets: real estate, productive land, business ownership, hard assets, and skills that retain value regardless of monetary conditions. Develop multiple income streams rather than depending on single employment. Build local economic networks and barter capabilities. The key is creating antifragile systems that benefit from instability rather than depending on institutional stability. This requires higher financial literacy and entrepreneurial thinking than previous generations needed.",

    "Crypto vs Traditional Assets": "userMessage: Should I invest in cryptocurrency or stick to traditional investments like stocks? --- councilResponse: Both crypto and traditional investments carry different risk profiles during monetary transition. Traditional assets (stocks, bonds) remain anchored to established systems but face devaluation through currency printing and institutional capture. Crypto offers potential hedge against traditional system collapse but carries volatility and regulatory risk. A balanced approach: maintain traditional assets for stability, allocate small percentage to crypto for asymmetric upside, but prioritize tangible assets (land, tools, skills, relationships) that retain value regardless of monetary system. The fundamental question isn't which investment vehicle but how to preserve wealth during systemic change.",

    "Health Decision Sovereignty": "userMessage: How do I make informed health decisions when I don't trust mainstream medical advice? --- councilResponse: Medical sovereignty requires developing personal health literacy while strategically engaging institutional healthcare when beneficial. Build foundational knowledge of anatomy, nutrition, and preventive principles. Cultivate relationships with practitioners who respect patient autonomy and integrate multiple healing modalities. Use institutional medicine for acute emergencies and diagnostic tools while maintaining decision-making authority. Develop alternative health support networks and learn traditional healing methods. Document your health choices and reasoning to maintain consistency under pressure.",

    "Health Research Methodology": "userMessage: What's the most effective way to research health information without getting overwhelmed by conflicting studies? --- councilResponse: Focus on research methodology and funding sources rather than just conclusions. Look for studies with proper control groups, adequate sample sizes, and longer time frames. Identify who funded the research and whether they benefit from specific outcomes. Prioritize meta-analyses and systematic reviews over single studies. Pay attention to biological plausibility - does the mechanism make sense? Cross-reference findings across different research traditions (Western medical, traditional medicine, biochemistry). Most importantly, observe your own body's responses to different interventions. Your direct experience, properly tracked, provides valuable data alongside formal research.",

    "Digital Surveillance Concerns": "userMessage: How concerned should I be about digital surveillance and privacy? --- councilResponse: Digital surveillance has reached unprecedented levels with direct implications for personal freedom and social control. Every digital interaction creates behavioral profiles used for influence and potential exclusion from economic opportunities. However, complete digital withdrawal is impractical. Strategic approach: understand your threat model (who might target you and why), use privacy tools proportional to your risk level, maintain alternative communication channels, and develop digital literacy to recognize manipulation. The goal isn't perfect privacy but maintaining agency and choice while resisting normalization of total surveillance.",

    "Essential Privacy Tools": "userMessage: What are the most important privacy tools I should start using immediately? --- councilResponse: Start with high-impact, low-friction changes: use Signal for messaging, switch to a privacy-focused browser like Brave or Firefox with uBlock Origin, use a VPN for browsing, and enable two-factor authentication on important accounts. For email, consider ProtonMail or Tutanota. Use privacy-focused search engines like DuckDuckGo or Startpage. Most importantly, change your default mindset: assume everything digital is being monitored and ask whether you need to make each digital interaction. The most powerful privacy tool is often choosing not to create the digital record in the first place.",

    "Artistic Integrity Balance": "userMessage: How do I maintain artistic integrity while needing to make money from creative work? --- councilResponse: The tension between artistic integrity and commercial viability requires strategic balance rather than choosing one over the other. Develop multiple revenue streams so no single source controls your creative choices. Build direct relationships with audiences who value your authentic voice rather than competing in algorithmic attention markets. Create different creative tracks - some commercial, some purely artistic - and price your authentic work to reflect its true value. Remember that commercial success can provide resources for more experimental work. The key is conscious choice rather than unconscious compromise.",

    "Social Media Algorithm Adaptation": "userMessage: Should I change my art to fit what's popular on social media platforms? --- councilResponse: Algorithmic platforms reward engagement over quality, creating a race to the bottom of human attention. Adapting your art to platform algorithms often compromises the very qualities that make it meaningful and unique. Instead, use platforms strategically to showcase your authentic work while building direct relationships that exist independent of any platform. Share your creative process, values, and story alongside finished work. Focus on attracting the right audience rather than the largest audience. The artists with lasting careers typically maintain creative integrity while learning to communicate their vision effectively, not by chasing trends.",

    "Community Building Challenge": "userMessage: How do I build meaningful community when everyone seems isolated and busy? --- councilResponse: Community building requires swimming against cultural currents toward individualism and digital substitution. Start with shared activities that create natural interaction: skill sharing, food production, tool libraries, or study groups. Focus on mutual benefit rather than social networking - people bond through working together toward common goals. Establish regular rhythms people can depend on. Be prepared to invest time and vulnerability before receiving reciprocal investment. Most people crave real connection but don't know how to create it. By taking initiative, you're often providing something others desperately want.",

    "Community Sustainability Factors": "userMessage: What makes some communities last while others fall apart quickly? --- councilResponse: Lasting communities share several characteristics: clear shared values that guide decision-making, effective conflict resolution processes that preserve relationships while addressing problems, distributed leadership that prevents both chaos and authoritarianism, economic cooperation that creates interdependence, and cultural traditions that maintain identity across time. They also adapt to circumstances without losing core identity. Fragmenting communities typically suffer from unclear values, poor communication, concentrated power, economic competition between members, or inability to integrate newcomers. Build resilient social architecture rather than depending on charismatic leadership alone.",

    "Spiritual Progress Assessment": "userMessage: How do I know if I'm making real spiritual progress or just having interesting experiences? --- councilResponse: Authentic spiritual progress manifests through sustained changes in daily behavior and relationship quality rather than peak experiences or esoteric knowledge. Real progress includes: increased capacity for patience under stress, reduced reactive patterns and ego defensiveness, improved discernment between truth and illusion, and expanded capacity for service without attachment to recognition. Spiritual experiences can catalyze growth but don't constitute growth themselves. The test is integration - do insights translate into wisdom in ordinary circumstances? Do you become easier to live with, more trustworthy, more genuinely loving?",

    "Individual vs Collective Awakening": "userMessage: Should I focus on individual spiritual development or community engagement for awakening? --- councilResponse: Individual and collective awakening are interdependent processes that mutually catalyze each other. Personal development creates capacity for authentic relationship and clear discernment - essential for healthy collective function. Collective engagement provides supportive environment and larger purpose that accelerate individual growth. However, neither alone is sufficient. Individual focus without community can become narcissistic bypassing. Community focus without personal work can become groupthink or mob dynamics. The integration requires individuals committed to their own growth who also engage responsibly in collective transformation. Both levels must evolve together for sustainable awakening."
};

  const communityProjects = [
    {title:"ACME v. Northwind - Legal case management for ACME lawsuit", status:"In Progress",     members:"Team Legal Alpha"},
    {title:"Mobile Banking App Redesign - Agile project for mobile banking UX overhaul",            status:"AGILE SPRINT - Planning",        members:"Team Design Beta"},
  ];

  const chat = document.getElementById('chatLog');
  const memoryList = document.getElementById('memoryList');
  const aiAgentHorizontalControls = document.getElementById('aiAgentHorizontalControls');
  const aiAgentStrip = document.getElementById('aiAgentStrip');
  const communityProjectsEl = document.getElementById('communityProjects');
  const logArea = document.getElementById('logArea');
  let selectedMemoryIndex = -1; // Track selected memory item

  function addUser(text){
    const el = document.createElement('div');
    el.className = 'msg user';
    el.innerHTML = `<div class="bubble" style="color:#eab676">${escapeHtml(text)}</div>`;
    chat.appendChild(el); chat.scrollTop = chat.scrollHeight;
  }
  function addAssistant(text){
    const el = document.createElement('div');
    el.className = 'msg assistant';
    el.innerHTML = text;
    chat.appendChild(el); chat.scrollTop = chat.scrollHeight;
  }

  // Define seedChat function
  function seedChat() {
    // Initial chat can be empty or contain welcome message
    // addAssistant('DYNAMO Council Interface');
  }

  function renderGauges(){
    gauges.forEach(g => {
      const element = document.getElementById(g.id);
      if (element) {
        const percentage = (g.value / g.max) * 100;
        element.style.setProperty('--gauge-percent', percentage + '%');
        if (g.unit === '%') {
          element.textContent = Math.round(percentage) + '%';
        } else {
          element.textContent = g.value + g.unit;
        }
      }
    });
  }

  function renderMemory(){
    memoryList.innerHTML = '';
    memory.forEach((m, index) => {
      const div = document.createElement('div');
      div.className = 'memory-item' + (selectedMemoryIndex === index ? ' selected' : '');
      div.innerHTML = `<h4>${m.title}</h4><p>${m.text}</p>`;
      div.addEventListener('click', () => {
        selectedMemoryIndex = index;
        renderMemory(); // Re-render to update selection
        updateAddToChatButton();
      });
      memoryList.appendChild(div);
    });
  }

  function updateAddToChatButton(){
    // Button remains always enabled to allow showing the alert
    // Visual feedback is provided through selection highlighting instead
  }

  function addMemoryToChat(){
    if(selectedMemoryIndex === -1) {
      alert("Please select a Memory Thread in the boxes above before Adding to Chat");
      return;
    }

    const selectedMemory = memory[selectedMemoryIndex];
    const memoryContent = recentThreadContent[selectedMemory.title];

    // Split content at --- separator and format labels
    const contentParts = memoryContent ? memoryContent.split('---').map(part => part.trim()) : [''];
    const formattedContent = contentParts
      .map(part => {
        return part
          .replace(/userMessage:/g, '<strong style="color:#eab676">userMessage:</strong>')
          .replace(/councilResponse:/g, '<strong style="color:#76aaea">councilResponse:</strong>');
      })
      .join('<br><br>');

    // Add as a past memory message to chat
    const el = document.createElement('div');
    el.className = 'msg assistant';
    el.innerHTML = `<div class="bubble"><strong>Past Memory: ${selectedMemory.title}</strong><br><br>${formattedContent}</div>`;
    chat.appendChild(el);
    chat.scrollTop = chat.scrollHeight;

    // Add space and "Thinking..." message
    setTimeout(() => {
      addAssistant('<p style="color:#999">Thinking…</p>');
    }, 500);

    // Add Council acknowledgment after 5 seconds
    setTimeout(() => {
      addAssistant('The Council acknowledges the memories. We are listening.');
    }, 5500);

    // Log the action
    log(`Added memory "${selectedMemory.title}" to chat`);
    showToast(`Memory added to chat`);

    // Clear selection after adding
    selectedMemoryIndex = -1;
    renderMemory();
    updateAddToChatButton();
  }

  function renderCommunityProjects(){
    communityProjectsEl.innerHTML = '';
    communityProjects.slice(0, 3).forEach(project => {
      const div = document.createElement('div'); div.className='community-item';
      div.innerHTML = `<h4>${project.title}</h4><p><strong>${project.status}</strong>&bull;${project.members}</p>`;
      communityProjectsEl.appendChild(div);
    });
  }

  function renderAiAgentControls(){
    const descriptions = {
      "iconoclast":"Goes beyond the prevailing narrative, questions, detects inversions, deceptions, and hidden patterns.",
      "authority":"Represents the prevailing official narrative, the baseline voice of institutions and consensus.",
      "strategist":"Turns knowledge into pathways forward — strategies, options, experiments, and next steps.",
      "archivist":"Retrieves and presents relevant memory and record for both user and council.",
      "secretariat":"Gathers, orders, and voices the council's deliberations and collective memory."
    };

    aiAgentHorizontalControls.innerHTML = '';
    aiAgentStrip.innerHTML = '';
    aiAgents.forEach(h=>{
      const item = document.createElement('div'); item.className='ai-agent-item';
      if(h.id === 'secretariat') {
        // Secretariat is always on and not toggleable
        item.innerHTML = `
          <div class="ai-agent-name">
            ${h.name}
            <sup class="help-icon-info">i
              <div class="tooltip">${descriptions[h.id]}</div>
            </sup>
          </div>
          <button class="ai-agent-button on">ON</button>
          <div style="color:var(--muted);font-size:11px;margin-top:4px;">Always Active</div>`;
      } else {
        item.innerHTML = `
          <div class="ai-agent-name">
            ${h.name}
            <sup class="help-icon-info">i
              <div class="tooltip">${descriptions[h.id]}</div>
            </sup>
          </div>
          <button class="ai-agent-button ${h.value > 0 ? 'on' : 'off'}">
            ${h.value > 0 ? 'ON' : 'OFF'}
          </button>
          <div class="pill-toggle" data-id="${h.id}">
            <input type="radio" id="on-${h.id}" name="toggle-${h.id}" ${h.value > 0 ? 'checked' : ''} class="toggle-input">
            <input type="radio" id="off-${h.id}" name="toggle-${h.id}" ${h.value > 0 ? '' : 'checked'} class="toggle-input">
            <label for="on-${h.id}" class="toggle-label">ON</label>
            <label for="off-${h.id}" class="toggle-label">OFF</label>
            <div class="toggle-slider"></div>
          </div>`;
      }
      aiAgentHorizontalControls.appendChild(item);

      const pill = document.createElement('div'); pill.className='ai-agent-pill';
      if(h.id === 'secretariat') {
        pill.textContent = `${h.name} On`;
      } else {
        pill.textContent = `${h.name} ${h.value > 0 ? 'On' : 'Off'}`;
      }
      aiAgentStrip.appendChild(pill);
    });

    document.querySelectorAll('.toggle-input').forEach(radio=>{
      radio.addEventListener('change', e=>{
        const pillToggle = e.target.closest('.pill-toggle');
        const id = pillToggle.dataset.id;
        const hol = aiAgents.find(h=>h.id===id);
        const isOn = e.target.id.startsWith('on-');
        hol.value = isOn ? 80 : 0;
        renderAiAgentControls();
        log('Toggled ' + hol.name + ' to ' + (isOn ? 'On' : 'Off'));
      });
    });
  }

  function log(msg){
    const t = new Date().toLocaleTimeString();
    logArea.innerHTML = `<div style="margin-bottom:6px">[${t}] ${msg}</div>` + logArea.innerHTML;
  }

  function showToast(t){
    const el = document.getElementById('toast'); el.textContent = t; el.style.display='block';
    setTimeout(()=>el.style.display='none',1300);
  }

  function populateThreadDropdown(){
    const select = document.getElementById('threadSelect');
    // Clear existing options except the first one
    select.innerHTML = '<option value="">-- Select a thread --</option>';
    // Add threads from shared data
    threads.forEach(thread => {
      const option = document.createElement('option');
      option.value = thread.title;
      option.textContent = thread.title;
      select.appendChild(option);
    });
  }

  function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])) }

  // --- main demo flow ---
  async function runDemo(){
    const qEl = document.getElementById('userQuestion');
    const q = qEl.value.trim() || "How should we demonstrate traction for DYNAMO?";
    qEl.value = '';

    addUser(q);
    document.getElementById('statusLine').innerText = 'Council deliberating…';
    log('Question: ' + q);

    // 1) Keep this opening line exactly
    const intro = "Council acknowledgment received. Beginning parallel deliberation across AI-Agents.";
    addAssistant(intro);

    // 2) Space + "Thinking…" beat
    await wait(2500);
    addAssistant('<p style="color:#999">Thinking…</p>');

    // small pause so the beat reads
    await wait(8000);

    // 3) Council Synthesis with proper paragraphs
    addAssistant(`<hr class="hr"><h3 style="color:#76aaea">Council Synthesis</h3>${produceSynthesis(q)}`);

    document.getElementById('statusLine').innerText = 'Synthesis ready';
    log('Synthesis produced');
  }

  // tiny promise-based delay helper
  function wait(ms){ return new Promise(r => setTimeout(r, ms)); }

  // --- synthesis content (returns HTML with real <p> blocks) ---
  function produceSynthesis(q){
    return `
      <p>This text is a sample output generated by the DYNAMO council. What you are seeing is not a single AI-Agent (i.e., LLM model and variant) speaking, but the integrated voice of several specialized agents working together. Each specialized AI-Agent contributes a perspective, some focused on precision, others on discernment, others strategies, and their dialogue is woven into a single response for the user. Even when the content is simple or generic, the process behind it reflects a deeper architecture of deliberation.</p>
      <p>The purpose of this demo text is to remind you that what appears here is not arbitrary. It is the visible layer of a mindful council process, where multiple voices check, challenge, and balance each other before anything is returned. The council 'unflattens' typical LLM responses.</p>
      <p>The system is designed to make this transparent and trustworthy, so that users understand not only the answer they receive, but also the integrity of the process that shaped it.</p>
      <p>In this demonstration, the text itself carries no special meaning beyond showing that the pipeline is active and coherent. It is a placeholder, meant to illustrate how the DYNAMO council surfaces responses. The real value comes when user questions draw upon memory, moral attractors, and collective intelligence, producing answers that are contextual, layered, and enduring.</p>
    `;
  }

  function pct(v){ return Math.round(v*100) + "%" }

  // WELCOME MODAL EVENT HANDLERS
  document.getElementById('welcomeCloseBtn').addEventListener('click', () => {
    document.getElementById('welcomeModal').style.display = 'none';
    log('Welcome box closed - user entered DYNAMO');
  });

  // Close welcome modal when clicking outside
  document.getElementById('welcomeModal').addEventListener('click', (e) => {
    if(e.target.id === 'welcomeModal') {
      document.getElementById('welcomeModal').style.display = 'none';
      log('Welcome box closed - user entered DYNAMO');
    }
  });

  // Function to clear chat and start new conversation
  function startNewConversation() {
    // Clear the chat log
    chat.innerHTML = '';

    // Clear the user input
    document.getElementById('userQuestion').value = '';

    // Reset status line
    document.getElementById('statusLine').innerText = 'Idle';

    // Log the action
    log('Started new conversation - chat cleared');
    showToast('Chat cleared - ready for new conversation');
  }

  // EXISTING EVENT HANDLERS
  document.getElementById('askBtn').addEventListener('click', runDemo);
  document.getElementById('newConversationBtn').addEventListener('click', startNewConversation);
  document.getElementById('llmSelect').addEventListener('change', (e)=>{
    const selectedLLM = e.target.value;
    log(`External LLM changed to ${selectedLLM}`);
    showToast(`LLM switched to ${selectedLLM}`);
  });
  document.getElementById('addToChatBtn').addEventListener('click', addMemoryToChat);
  document.getElementById('bypassToggle').addEventListener('change', (e)=>{
    const isChecked = e.target.checked;
    log(`Bypass External LLM ${isChecked ? 'enabled' : 'disabled'}`);
    showToast(`External LLM ${isChecked ? 'bypassed' : 'enabled'}`);
  });
  document.getElementById('bypassCouncilToggle').addEventListener('change', (e)=>{
    const isChecked = e.target.checked;
    log(`Bypass Council ${isChecked ? 'enabled' : 'disabled'}`);
    showToast(`Council ${isChecked ? 'bypassed' : 'enabled'}`);
  });
  document.getElementById('resolvedBtn').addEventListener('click', ()=>{
    log('Status marked as Resolved'); showToast('Marked as Resolved');
  });
  document.getElementById('unresolvedBtn').addEventListener('click', ()=>{
    log('Status marked as Unresolved'); showToast('Marked as Unresolved');
  });
  document.getElementById('dismissBtn').addEventListener('click', ()=>{
    log('Status marked as Dismissed'); showToast('Dismissed');
  });
  document.getElementById('sendToCommunityBtn').addEventListener('click', ()=>{
    populateThreadDropdown();
    document.getElementById('communityModal').style.display = 'flex';
    document.getElementById('threadSelect').focus();
  });

  document.getElementById('modalSendBtn').addEventListener('click', ()=>{
    const selectedThread = document.getElementById('threadSelect').value;
    const customThread = document.getElementById('threadNameInput').value.trim();
    const threadName = selectedThread || customThread;

    if(threadName) {
      log(`Sent to Community Thread: "${threadName}"`);
      showToast(`Sent to Community: ${threadName}`);
      document.getElementById('communityModal').style.display = 'none';
      document.getElementById('threadSelect').value = '';
      document.getElementById('threadNameInput').value = '';
    } else {
      showToast('Please select a thread or enter a thread name');
    }
  });

  document.getElementById('modalCancelBtn').addEventListener('click', ()=>{
    document.getElementById('communityModal').style.display = 'none';
    document.getElementById('threadSelect').value = '';
    document.getElementById('threadNameInput').value = '';
  });

  // Close modal when clicking outside
  document.getElementById('communityModal').addEventListener('click', (e)=>{
    if(e.target.id === 'communityModal') {
      document.getElementById('communityModal').style.display = 'none';
      document.getElementById('threadSelect').value = '';
      document.getElementById('threadNameInput').value = '';
    }
  });

  // Handle Enter key in input field
  document.getElementById('threadNameInput').addEventListener('keypress', (e)=>{
    if(e.key === 'Enter') {
      document.getElementById('modalSendBtn').click();
    }
  });
  document.getElementById('showAllCommsBtn').addEventListener('click', ()=>{
    log('Go To Community Console clicked');
    showToast('Opening all community interactions...');
    // Works on Cloudflare AND any local server
    window.location.href = "dynamo-community-dashboard/index.html";
  });

  document.getElementById('showMemoryConsoleBtn').addEventListener('click', ()=>{
    log('Go To Memory Console clicked');
    showToast('Opening memory dashboard...');
    window.location.href = "memorydashboard/index.html";
  });

  // DYNAMO receiver for Memory Dashboard import
  function checkForMemoryImport() {
    try {
      const KEY = 'dynamo:previewImport';
      const raw = sessionStorage.getItem(KEY);

      console.log('Checking for memory import...', raw ? 'Found data' : 'No data');

      if (!raw) return;

      const payload = JSON.parse(raw);
      console.log('Parsed payload:', payload);

      sessionStorage.removeItem(KEY);

      if (payload?.type !== 'preview_import') {
        console.warn('Invalid payload type:', payload?.type);
        return;
      }

      // Display summary and context in chat
      const itemCount = payload.items?.length || 0;
      console.log('Importing', itemCount, 'records with summary:', payload.summary);

      // Add imported summary to chat
      addAssistant(`<hr class="hr"><h3 style="color:#76aaea">Imported Memory Context</h3><p><strong>Summary:</strong> ${escapeHtml(payload.summary)}</p>`);

      // Add record details if in full mode
      if (payload.mode === 'full' && payload.items && payload.items.length > 0) {
        let recordsHtml = '<div style="margin-top:12px;"><strong>Retrieved Records:</strong></div>';
        payload.items.forEach((item, index) => {
          recordsHtml += `
            <div style="margin:8px 0;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;border:1px solid rgba(255,255,255,0.06);">
              <div style="font-size:13px;font-weight:600;">${index + 1}. ${escapeHtml(item.title)}</div>
              <div style="font-size:12px;color:var(--muted);margin-top:4px;">Status: ${escapeHtml(item.status)} | ${formatTimestamp(item.timestamp)}</div>
              ${item.userMessage ? `<div style="margin-top:6px;font-size:12px;"><strong style="color:#eab676;">User:</strong> ${escapeHtml(item.userMessage)}</div>` : ''}
              ${item.councilResponse ? `<div style="margin-top:4px;font-size:12px;"><strong style="color:#76aaea;">Council:</strong> ${escapeHtml(item.councilResponse.substring(0, 200))}${item.councilResponse.length > 200 ? '...' : ''}</div>` : ''}
            </div>
          `;
        });
        addAssistant(recordsHtml);
      }

      // Show success notification
      showToast(`Imported ${itemCount} memory record${itemCount === 1 ? '' : 's'}`);
      log(`Imported ${itemCount} record(s) from Memory Dashboard`);

    } catch (e) {
      console.error('Memory import failed:', e);
      showToast('Failed to import memory context');
    }
  }

  // Helper function to format timestamp
  function formatTimestamp(timestamp) {
    if (!timestamp) return '';
    const date = new Date(timestamp);
    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  }

  // INIT
  renderGauges(); renderMemory(); renderAiAgentControls(); renderCommunityProjects(); seedChat();

  // Check for memory import after initialization
  checkForMemoryImport();
</script>
</body>
</html>
