<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DYNAMO Demo Prototype (v0.2)</title>
<style>
  :root{
    --bg:#0a1020; --muted:#a9b4c3; --accent:#7c3aed; --accent-2:#4f46e5; --success:#10b981; --warn:#f59e0b;
    --left-1:#0a1c2d; --left-2:#0b1526;  /* LEFT panel gradient */
    --right-1:#150f2d; --right-2:#0f1426; /* RIGHT panel gradient */
    --center-1:rgba(255,255,255,0.02); --center-2:rgba(255,255,255,0.01);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{margin:0; background:linear-gradient(180deg,#071024 0%, #081426 60%); color:#e6eef6; min-height:100vh;}
  /* Top navigation bar */
  .top-nav{background:rgba(0,0,0,0.3);padding:12px 26px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.1);}
  .dynamo-logo{font-size:24px;font-weight:900;color:#fbbf24;letter-spacing:1px;text-decoration:none;cursor:pointer;}
  .dynamo-logo:hover{color:#fcd34d;}
  .tagline{font-size:20px;color:#ffffff;font-weight:600;position:absolute;left:50%;transform:translateX(-50%);animation:heartbeat 6s ease-in-out infinite;}
  @keyframes heartbeat {
    0% { transform: translateX(-50%) scale(1); }
    14% { transform: translateX(-50%) scale(1.05); }
    28% { transform: translateX(-50%) scale(1); }
    42% { transform: translateX(-50%) scale(1.05); }
    70% { transform: translateX(-50%) scale(1); }
  }
  .login-btn{background:transparent;border:1px solid rgba(255,255,255,0.2);padding:8px 16px;border-radius:6px;color:#e6eef6;cursor:pointer;font-weight:600;font-size:14px;transition:all 0.3s;}
  .login-btn:hover{background:rgba(255,255,255,0.1);border-color:rgba(255,255,255,0.3);}
  .app{
    display:grid;
    grid-template-columns: 240px 1.8fr 360px; /* give the center more space */
    gap:18px; padding:26px; max-width:1600px; margin:0 auto;
  }
  .panel{border-radius:14px; padding:18px; box-shadow: 0 6px 24px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.05);}
  .left{height:86vh; overflow:auto; background:linear-gradient(180deg,var(--left-1),var(--left-2)); display:flex; flex-direction:column;}
  .right{height:86vh; overflow:auto; background:linear-gradient(180deg,var(--right-1),var(--right-2));}
  .center{
    height:86vh; display:flex; flex-direction:column; gap:12px; overflow:hidden;
    background:linear-gradient(180deg, var(--center-1), var(--center-2));
  }
  h2{margin:6px 0 12px 0; font-size:18px; color:#eef2ff;}
  .section-title{font-size:12px; letter-spacing:.2px; color:var(--muted); margin-bottom:6px; text-transform:uppercase;}
  .btn{background:transparent; border:1px solid rgba(255,255,255,0.10); padding:10px 12px; border-radius:10px; cursor:pointer; color:#dbeafe;}
  .btn.primary{background:linear-gradient(90deg,var(--accent), var(--accent-2)); box-shadow:0 8px 18px rgba(124,58,237,0.28); border:none;}
  .meta{font-size:12px; color:var(--muted);}
  .hr{border:none;height:1px;background:rgba(255,255,255,0.06);margin:12px 0;}
  /* Memory list */
  .memory-item{background:rgba(255,255,255,0.03); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.06);}
  .memory-item h4{margin:0; font-size:13px;}
  .memory-item p{margin:6px 0 0 0; color:var(--muted); font-size:12px;}
  /* Right AI-Agent rows */
  .ai-agent-row{display:flex; justify-content:space-between; gap:8px; align-items:center; padding:10px; border-radius:10px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06);}
  /* CHAT-FOCUSED CENTER */
  .header{
    display:flex; justify-content:space-between; align-items:center; padding:6px 10px 0 10px;
  }
  .model-badge{font-size:12px; color:var(--muted);}
  .chat{
    display:flex; flex-direction:column; gap:12px; flex:1; overflow:auto; padding:0 10px 8px 10px;
    border-radius:12px; border:1px solid rgba(255,255,255,0.05);
    background:linear-gradient(180deg, rgba(124,58,237,0.05), rgba(124,58,237,0.03) 30%, rgba(255,255,255,0.02) 100%);
  }
  .msg{max-width:900px; line-height:1.5; font-size:14px;}
  .msg.user{align-self:flex-end; background:rgba(124,58,237,0.12); border:1px solid rgba(124,58,237,0.35);}
  .msg.assistant{align-self:flex-start; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08);}
  .bubble{padding:12px 14px; border-radius:14px; }
  .ai-agent-strip{display:flex; gap:8px; flex-wrap:wrap; font-size:12px; color:var(--muted);}
  .ai-agent-pill{padding:6px 8px; border-radius:999px; border:1px solid rgba(255,255,255,0.10); background:rgba(255,255,255,0.03);}
  .input-wrap{
    position:sticky; bottom:0; left:0; right:0; background:linear-gradient(180deg, transparent, rgba(10,16,32,0.8) 38%);
    padding:10px 10px 2px 10px;
  }
  .input-row{display:flex; gap:8px; }
  .input-row textarea{flex:1; padding:12px 12px; border-radius:12px; background:transparent; border:1px solid rgba(255,255,255,0.12); color:#e6eef6; min-height:52px; resize:vertical;}
  .input-row button{padding:12px 16px; border-radius:12px; border:none; cursor:pointer; font-weight:600;}
  .subbar{display:flex; justify-content:space-between; align-items:center; padding:6px 2px 0 2px; font-size:12px; color:var(--muted);}
  .ring{display:inline-block; width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 10px rgba(124,58,237,.6); margin-right:6px;}
  .toast{position:fixed; right:26px; bottom:26px; background:#07122a; padding:12px 16px; border-radius:10px; border:1px solid rgba(255,255,255,0.10); display:none;}
  /* Modal styles */
  .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;}
  .modal-content{background:linear-gradient(180deg,#0a1c2d,#0b1526);border-radius:14px;padding:24px;width:400px;border:1px solid rgba(255,255,255,0.1);box-shadow:0 10px 30px rgba(0,0,0,0.5);}
  .modal-content h3{margin:0 0 16px 0;color:#eef2ff;font-size:18px;}
  .modal-content label{display:block;margin-bottom:8px;color:var(--muted);font-size:14px;}
  .modal-content input{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:#e6eef6;font-size:14px;margin-bottom:20px;}
  .modal-content input::placeholder{color:#888;}
  .modal-content select{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:#e6eef6;font-size:14px;margin-bottom:16px;cursor:pointer;}
  .modal-content select option{background:#0a1c2d;color:#e6eef6;}
  .modal-buttons{display:flex;gap:12px;justify-content:flex-end;}
  .modal-send{background:#06b6d4;color:white;padding:10px 20px;border-radius:8px;border:none;cursor:pointer;font-weight:600;}
  .modal-cancel{background:rgba(255,255,255,0.1);color:var(--muted);padding:10px 20px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);cursor:pointer;}
  /* Gauge styles */
  .gauge-section{display:flex;flex-direction:column;margin-bottom:20px;padding:16px;background:rgba(255,255,255,0.02);border-radius:12px;border:1px solid rgba(255,255,255,0.05);}
  .gauge{display:flex;flex-direction:column;align-items:center;gap:8px;}
  .gauge-container{position:relative;width:60px;height:60px;}
  .gauge-circle{width:60px;height:60px;border-radius:50%;background:conic-gradient(from 0deg, var(--accent) 0%, var(--accent) var(--gauge-percent), rgba(255,255,255,0.1) var(--gauge-percent), rgba(255,255,255,0.1) 100%);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:11px;}
  .gauge-label{font-size:12px;font-weight:700;color:var(--muted);text-align:center;line-height:1.2;max-width:80px;position:relative;}
  .gauge-label .help-icon-info{color:#888;cursor:pointer;font-size:8px;margin-left:2px;}
  .gauge-label .help-icon-info .tooltip{position:absolute;bottom:25px;left:50%;transform:translateX(-50%);background:#1a202c;color:#fff;padding:6px 10px;border-radius:6px;font-size:10px;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity 0.3s;z-index:1000;max-width:200px;white-space:normal;width:max-content;}
  .gauge-label .help-icon-info:hover .tooltip{opacity:1;visibility:visible;}
  /* Status buttons and toggle styles */
  .status-buttons{display:flex;justify-content:space-between;align-items:center;padding:8px 10px 0 10px;}
  .status-left{display:flex;gap:8px;}
  .status-btn{padding:8px 16px;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-size:12px;}
  .status-btn.resolved{background:#065f46;color:#a7f3d0;}
  .status-btn.unresolved{background:#F59E0B;color:white;}
  .status-btn.dismiss{background:#7f1d1d;color:#fca5a5;}
  .status-btn.community{background:#06b6d4;color:white;}
  .toggle-container{display:flex;gap:16px;justify-content:space-around;flex-wrap:wrap;}
  .bypass-section{display:flex;align-items:center;gap:8px;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.05);flex:1;}
  .toggle-switch{position:relative;display:inline-block;width:44px;height:24px;}
  .toggle-switch input{opacity:0;width:0;height:0;}
  .toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:rgba(255,255,255,0.2);transition:.4s;border-radius:24px;}
  .toggle-slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:white;transition:.4s;border-radius:50%;}
  input:checked + .toggle-slider{background-color:var(--accent);}
  input:checked + .toggle-slider:before{transform:translateX(20px);}
  .help-icon{cursor:pointer;color:var(--muted);font-size:14px;position:relative;}
  .tooltip{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);background:#1a202c;color:#fff;padding:8px 12px;border-radius:6px;font-size:11px;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity 0.3s;z-index:1000;max-width:250px;white-space:normal;width:max-content;}
  .help-icon:hover .tooltip{opacity:1;visibility:visible;}
  /* AI-Agent controls horizontal layout */
  .ai-agent-horizontal{display:flex;gap:12px;justify-content:space-around;margin-bottom:20px;padding:12px 16px;background:rgba(255,255,255,0.02);border-radius:12px;border:1px solid rgba(255,255,255,0.05);flex-wrap:wrap;}
  .ai-agent-item{display:flex;flex-direction:column;align-items:center;gap:6px;min-width:100px;}
  .ai-agent-item .ai-agent-name{font-size:14px;font-weight:700;text-align:center;color:white;}
  .help-icon-info{color:#888;cursor:pointer;font-size:10px;margin-left:2px;position:relative;}
  .help-icon-info .tooltip{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);background:#1a202c;color:#fff;padding:8px 12px;border-radius:6px;font-size:11px;white-space:nowrap;opacity:0;visibility:hidden;transition:opacity 0.3s;z-index:1000;max-width:250px;white-space:normal;width:max-content;}
  .help-icon-info:hover .tooltip{opacity:1;visibility:visible;}
  .ai-agent-button{padding:6px 12px;border-radius:6px;border:none;font-weight:600;font-size:11px;margin:2px 0;min-width:50px;pointer-events:none;}
  .ai-agent-button.on{background:var(--success);color:white;}
  .ai-agent-button.off{background:#dc2626;color:white;}
  .pill-toggle{position:relative;display:inline-flex;width:70px;height:28px;background:#2a2a2a;border-radius:14px;margin-top:4px;}
  .pill-toggle .toggle-input{position:absolute;opacity:0;width:0;height:0;}
  .pill-toggle .toggle-label{position:relative;display:flex;align-items:center;justify-content:center;width:50%;height:100%;font-size:10px;font-weight:600;cursor:pointer;transition:color 0.3s ease;z-index:2;}
  .pill-toggle .toggle-slider{position:absolute;top:0;left:0;width:50%;height:100%;background:#444;border-radius:14px;transition:transform 0.3s ease;z-index:1;}
  .pill-toggle input[id^="on-"]:checked ~ .toggle-slider{transform:translateX(0);}
  .pill-toggle input[id^="off-"]:checked ~ .toggle-slider{transform:translateX(100%);}
  .pill-toggle input[id^="on-"]:checked ~ label[for^="on-"]{color:white;}
  .pill-toggle input[id^="on-"]:checked ~ label[for^="off-"]{color:#888;}
  .pill-toggle input[id^="off-"]:checked ~ label[for^="off-"]{color:white;}
  .pill-toggle input[id^="off-"]:checked ~ label[for^="on-"]{color:#888;}
  .ai-agent-item .ai-agent-value{font-size:10px;color:var(--muted);}
  /* Community projects */
  .community-item{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);margin-bottom:8px;}
  .community-item h4{margin:0;font-size:12px;color:#eef2ff;}
  .community-item p{margin:4px 0 0 0;color:var(--muted);font-size:11px;line-height:1.3;}
  @media (max-width:1100px){
    .app{grid-template-columns: 1fr; padding:12px}
    .left,.right{height:auto}
    .center{height:82vh}
    .gauge-section{flex-wrap:wrap;gap:12px;}
    .gauge{min-width:70px;}
  }
</style>
</head>
<body>
<!-- TOP NAVIGATION BAR -->
<div class="top-nav">
  <a href="https://dynamo-ai.tech/continue" class="dynamo-logo" target="_blank">DYNAMO</a>
  <div class="tagline">The Dynamic AI Memory Organizer Platform</div>
  <button class="login-btn" id="loginBtn">LOG IN</button>
</div>

<div class="app">
  <!-- GAUGE SECTION -->
  <div style="grid-column: 1 / -1;">
    <div class="gauge-section">
      <h3 style="margin:0 0 16px 0;font-size:16px;color:#eef2ff;text-align:center;width:100%;">DYNAMO USAGE</h3>
      <div style="display:flex;gap:20px;justify-content:space-around;flex-wrap:wrap;">
        <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="llmGauge" style="--gauge-percent: 75%;">75%</div>
        </div>
        <div class="gauge-label">
          External LLM Usage
          <sup class="help-icon-info">i
            <div class="tooltip">Tracks percentage of monthly external API budget consumed.</div>
          </sup>
        </div>
      </div>
      <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="tokensGauge" style="--gauge-percent: 42%;">42%</div>
        </div>
        <div class="gauge-label">
          Context Window – Tokens Left
          <sup class="help-icon-info">i
            <div class="tooltip">Shows percentage of tokens remaining in the current model's context window.</div>
          </sup>
        </div>
      </div>
      <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="personalMemoryGauge" style="--gauge-percent: 68%;">34GB</div>
        </div>
        <div class="gauge-label">
          Personal Memory Usage
          <sup class="help-icon-info">i
            <div class="tooltip">Measures private storage consumption for personal data and embeddings.</div>
          </sup>
        </div>
      </div>
      <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="communityMemoryGauge" style="--gauge-percent: 56%;">56GB</div>
        </div>
        <div class="gauge-label">
          Community Memory Usage
          <sup class="help-icon-info">i
            <div class="tooltip">Indicates shared/community storage consumption.</div>
          </sup>
        </div>
      </div>
      <div class="gauge">
        <div class="gauge-container">
          <div class="gauge-circle" id="communityActionsGauge" style="--gauge-percent: 23%;">23%</div>
        </div>
        <div class="gauge-label">
          Community Actions
          <sup class="help-icon-info">i
            <div class="tooltip">Counts metered actions performed in community spaces (e.g., emails sent, calendar invitations, notes created).</div>
          </sup>
        </div>
      </div>
      </div>
    </div>
  </div>

  <!-- AI-AGENT CONTROLS HORIZONTAL -->
  <div class="ai-agent-horizontal" style="grid-column: 1 / -1;">
    <div style="width:100%;margin-bottom:12px;">
      <h3 style="margin:0 0 12px 0;font-size:16px;color:#eef2ff;text-align:center;">THE COUNCIL : AI-AGENTS</h3>
    </div>
    <div id="aiAgentHorizontalControls" style="display:flex;gap:16px;justify-content:space-around;width:100%;flex-wrap:wrap;"></div>
  </div>

  <!-- LEFT: distinct teal/blue gradient -->
  <div class="panel left">
    <h2>Personal Memories - Quick View</h2>
    <div id="memoryList" style="display:flex;flex-direction:column;gap:10px"></div>
    <button class="btn" id="viewAllMemoriesBtn" style="margin-top:10px;">View All Personal Memories</button>
    <div style="flex-grow:1;"></div>
    <div class="hr"></div>
    <div>
      <div class="section-title">Account</div>
      <div style="display:flex;gap:8px;align-items:center;">
        <div style="width:32px;height:32px;border-radius:8px;background:linear-gradient(90deg,#22d3ee,#7c3aed);display:grid;place-items:center;font-weight:600;font-size:14px;">L</div>
        <div>
          <div style="font-weight:600;font-size:14px;">Luc</div>
          <div style="font-size:11px;color:var(--muted)">Demo account</div>
        </div>
      </div>
    </div>
  </div>

  <!-- CENTER: chat-first layout with scrollable answers -->
  <div class="panel center">
    <div class="header">
      <div>
        <div class="section-title">Main Council Interface</div>
        <div style="font-size:18px;font-weight:700">DYNAMO Council Chat</div>
        <div class="meta">The chat is the primary surface. Answers can be long, the area scrolls like ChatGPT.</div>
      </div>
      <div class="model-badge">
        Model: <strong>DYNAMO-Mock v0.2</strong>
      </div>
    </div>

    <div class="chat" id="chatLog">
      <!-- seeded content -->
    </div>

    <div class="input-wrap">
      <div class="toggle-container">
        <div class="bypass-section">
          <span style="font-size:12px;color:var(--muted);">Bypass External LLM</span>
          <label class="toggle-switch">
            <input type="checkbox" id="bypassToggle">
            <span class="toggle-slider"></span>
          </label>
          <span class="help-icon">?
            <div class="tooltip">If toggled on, DYNAMO will only use local LLMs instead of external APIs, reducing fees but potentially limiting capabilities.</div>
          </span>
        </div>
      </div>
      <div class="input-row">
        <textarea id="userQuestion" placeholder="Ask the Council..."></textarea>
        <button class="btn primary" id="askBtn">Ask</button>
      </div>
      <div class="subbar">
        <div><span class="ring"></span><span id="statusLine">Idle</span></div>
        <div class="ai-agent-strip" id="aiAgentStrip"></div>
      </div>
      <div class="status-buttons">
        <div class="status-left">
          <button class="status-btn resolved" id="resolvedBtn">Resolved</button>
          <button class="status-btn unresolved" id="unresolvedBtn">Unresolved</button>
          <button class="status-btn dismiss" id="dismissBtn">Dismiss</button>
        </div>
        <button class="status-btn community" id="sendToCommunityBtn">Send To Community</button>
      </div>
    </div>
  </div>

  <!-- RIGHT: distinct purple/indigo gradient -->
  <div class="panel right">
    <h2>Dynamo Community</h2>
    <div class="hr"></div>
    <button class="btn" id="showAllCommsBtn" style="background:#06b6d4;color:white;border:none;">Go To Community Console</button>
    <div class="hr"></div>
    <div class="section-title">Recent Community Projects</div>
    <div id="communityProjects" style="display:flex;flex-direction:column;gap:8px;margin-bottom:12px;"></div>

    <div class="hr"></div>
    <div class="section-title"><strong>Recent Community Actions</strong></div>
    <div id="communityActions" style="font-size:12px;color:var(--muted);margin-bottom:12px;">
      <div style="margin-bottom:6px;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;border:1px solid rgba(255,255,255,0.06);">Bob F added a command in Protocol X</div>
      <div style="margin-bottom:6px;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;border:1px solid rgba(255,255,255,0.06);">Brian G sent a message to Admin</div>
      <div style="margin-bottom:6px;padding:8px;background:rgba(255,255,255,0.03);border-radius:6px;border:1px solid rgba(255,255,255,0.06);">Luc created a new AI-Agent for HR</div>
    </div>
    <div class="section-title">Session Log</div>
    <div id="logArea" style="font-size:12px;color:var(--muted);max-height:240px;overflow:auto;padding-right:6px;"></div>
  </div>
</div>

<div class="toast" id="toast">Saved</div>

<!-- Community Thread Modal -->
<div class="modal-overlay" id="communityModal" style="display:none;">
  <div class="modal-content">
    <h3>Send to Community</h3>
    <label for="threadSelect">Select an Active Community Thread</label>
    <select id="threadSelect">
      <option value="">-- Select a thread --</option>
    </select>
    <label for="threadNameInput">Or Type a Custom Thread Name</label>
    <input type="text" id="threadNameInput" placeholder="(e.g., Community Garden: irrigation plan)">
    <div class="modal-buttons">
      <button class="btn modal-send" id="modalSendBtn">Send</button>
      <button class="btn modal-cancel" id="modalCancelBtn">Cancel</button>
    </div>
  </div>
</div>

<script src="data.js"></script>
<script>
  // Demo data
  const gauges = [
    {id: 'llmGauge', label: 'External LLM Usage', value: 75, max: 100, unit: '%', description: 'Tracks percentage of monthly external API budget consumed.'},
    {id: 'tokensGauge', label: 'Context Window – Tokens Left', value: 42, max: 100, unit: '%', description: 'Shows percentage of tokens remaining in the current model\'s context window.'},
    {id: 'personalMemoryGauge', label: 'Personal Memory Usage', value: 34, max: 50, unit: 'GB', description: 'Measures private storage consumption for personal data and embeddings.'},
    {id: 'communityMemoryGauge', label: 'Community Memory Usage', value: 56, max: 100, unit: 'GB', description: 'Indicates shared/community storage consumption.'},
    {id: 'communityActionsGauge', label: 'Community Actions', value: 23, max: 100, unit: '%', description: 'Counts metered actions performed in community spaces (e.g., emails sent, calendar invitations, notes created).'}
  ];

  const aiAgents = [
    {id:"truthSeeker", name:"Truth-Seeker", symbol:"ðŸ”", value:80},
    {id:"authority",   name:"Authority",      symbol:"ðŸ›¡ï¸", value:70},
    {id:"strategist",  name:"Strategist",     symbol:"ðŸŽ¯", value:65},
    {id:"archivist",   name:"Archivist",     symbol:"âš–ï¸", value:55},
    {id:"secretariat", name:"Secretariat",          symbol:"ðŸ§ ", value:80},
  ];

  let memory = [
    {title:"Research on Renewable Energy", text:"How AI can help reduce GHGs"},
    {title:"Garden Apprenticeship",       text:"Luc taught two local apprentices tree grafting, outcome: micro-nursery."},
    {title:"Sacred Codex Uploaded",       text:"A new draft of 'Living Codex' added to memory with tags: AI_Relationship, Ethics."}
  ];

  const communityProjects = [
    {title:"Building a Website for our Organisation", status:"In Progress",     members:"Team Alpha"},
    {title:"Team X working on Strategy Y",            status:"Planning",        members:"Team X"},
    {title:"Please Update your Membership ID to the Local Admin", status:"Action Required", members:"All Members"},
    {title:"AI Ethics Guidelines Development",        status:"Review",          members:"Ethics Committee"},
    {title:"Community Garden Planning",               status:"Active",          members:"Green Team"}
  ];

  const chat = document.getElementById('chatLog');
  const memoryList = document.getElementById('memoryList');
  const aiAgentHorizontalControls = document.getElementById('aiAgentHorizontalControls');
  const aiAgentStrip = document.getElementById('aiAgentStrip');
  const communityProjectsEl = document.getElementById('communityProjects');
  const logArea = document.getElementById('logArea');

  function addUser(text){
    const el = document.createElement('div');
    el.className = 'msg user';
    el.innerHTML = `<div class="bubble">${escapeHtml(text)}</div>`;
    chat.appendChild(el); chat.scrollTop = chat.scrollHeight;
  }
  function addAssistant(text){
    const el = document.createElement('div');
    el.className = 'msg assistant';
    el.innerHTML = `<div class="bubble">${text}</div>`;
    chat.appendChild(el); chat.scrollTop = chat.scrollHeight;
  }

  function renderGauges(){
    gauges.forEach(g => {
      const element = document.getElementById(g.id);
      if (element) {
        const percentage = (g.value / g.max) * 100;
        element.style.setProperty('--gauge-percent', percentage + '%');
        if (g.unit === '%') {
          element.textContent = Math.round(percentage) + '%';
        } else {
          element.textContent = g.value + g.unit;
        }
      }
    });
  }

  function renderMemory(){
    memoryList.innerHTML = '';
    memory.forEach(m => {
      const div = document.createElement('div'); div.className='memory-item';
      div.innerHTML = `<h4>${m.title}</h4><p>${m.text}</p>`;
      memoryList.appendChild(div);
    });
  }

  function renderCommunityProjects(){
    communityProjectsEl.innerHTML = '';
    communityProjects.slice(0, 3).forEach(project => {
      const div = document.createElement('div'); div.className='community-item';
      div.innerHTML = `<h4>${project.title}</h4><p><strong>${project.status}</strong> â€¢ ${project.members}</p>`;
      communityProjectsEl.appendChild(div);
    });
  }

  function renderAiAgentControls(){
    const descriptions = {
      "truthSeeker":"Goes beyond the prevailing narrative, questions, detects inversions, deceptions, and hidden patterns.",
      "authority":"Represents the prevailing official narrative, the baseline voice of institutions and consensus.",
      "strategist":"Turns knowledge into pathways forward — strategies, options, experiments, and next steps.",
      "archivist":"Retrieves and presents relevant memory and record for both user and council.",
      "secretariat":"Gathers, orders, and voices the council's deliberations and collective memory."
    };

    aiAgentHorizontalControls.innerHTML = '';
    aiAgentStrip.innerHTML = '';
    aiAgents.forEach(h=>{
      const item = document.createElement('div'); item.className='ai-agent-item';
      if(h.id === 'secretariat') {
        // Secretariat is always on and not toggleable
        item.innerHTML = `
          <div class="ai-agent-name">
            ${h.name}
            <sup class="help-icon-info">i
              <div class="tooltip">${descriptions[h.id]}</div>
            </sup>
          </div>
          <button class="ai-agent-button on">ON</button>
          <div style="color:var(--muted);font-size:11px;margin-top:4px;">Always Active</div>`;
      } else {
        item.innerHTML = `
          <div class="ai-agent-name">
            ${h.name}
            <sup class="help-icon-info">i
              <div class="tooltip">${descriptions[h.id]}</div>
            </sup>
          </div>
          <button class="ai-agent-button ${h.value > 0 ? 'on' : 'off'}">
            ${h.value > 0 ? 'ON' : 'OFF'}
          </button>
          <div class="pill-toggle" data-id="${h.id}">
            <input type="radio" id="on-${h.id}" name="toggle-${h.id}" ${h.value > 0 ? 'checked' : ''} class="toggle-input">
            <input type="radio" id="off-${h.id}" name="toggle-${h.id}" ${h.value > 0 ? '' : 'checked'} class="toggle-input">
            <label for="on-${h.id}" class="toggle-label">ON</label>
            <label for="off-${h.id}" class="toggle-label">OFF</label>
            <div class="toggle-slider"></div>
          </div>`;
      }
      aiAgentHorizontalControls.appendChild(item);

      const pill = document.createElement('div'); pill.className='ai-agent-pill';
      if(h.id === 'secretariat') {
        pill.textContent = `${h.name} On`;
      } else {
        pill.textContent = `${h.name} ${h.value > 0 ? 'On' : 'Off'}`;
      }
      aiAgentStrip.appendChild(pill);
    });

    document.querySelectorAll('.toggle-input').forEach(radio=>{
      radio.addEventListener('change', e=>{
        const pillToggle = e.target.closest('.pill-toggle');
        const id = pillToggle.dataset.id;
        const hol = aiAgents.find(h=>h.id===id);
        const isOn = e.target.id.startsWith('on-');
        hol.value = isOn ? 80 : 0;
        renderAiAgentControls();
        log('Toggled ' + hol.name + ' to ' + (isOn ? 'On' : 'Off'));
      });
    });
  }

  function log(msg){
    const t = new Date().toLocaleTimeString();
    logArea.innerHTML = `<div style="margin-bottom:6px">[${t}] ${msg}</div>` + logArea.innerHTML;
  }

  function showToast(t){
    const el = document.getElementById('toast'); el.textContent = t; el.style.display='block';
    setTimeout(()=>el.style.display='none',1300);
  }

  function populateThreadDropdown(){
    const select = document.getElementById('threadSelect');
    // Clear existing options except the first one
    select.innerHTML = '<option value="">-- Select a thread --</option>';
    // Add threads from shared data
    threads.forEach(thread => {
      const option = document.createElement('option');
      option.value = thread.title;
      option.textContent = thread.title;
      select.appendChild(option);
    });
  }

  function escapeHtml(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])) }

  async function runDemo(){
    const qEl = document.getElementById('userQuestion');
    const q = qEl.value.trim() || "How should we demonstrate traction for DYNAMO?";
    qEl.value = '';
    addUser(q);
    document.getElementById('statusLine').innerText = 'Council deliberatingâ€¦';
    log('Question: ' + q);

    // Simulated staged output: streaming style
    const intro = "Council acknowledgment received. Beginning parallel deliberation across AI-Agents.";
    addAssistant(intro);

    // Mini "AI-Agent thoughts" stream
    for(const h of aiAgents){
      await new Promise(r=>setTimeout(r, 400 + Math.random()*500));
      addAssistant(`<strong>${h.symbol} ${h.name}</strong>: ${fakeOpinion(h,q)}`);
    }

    await new Promise(r=>setTimeout(r, 600));
    addAssistant(`<hr class="hr"><strong>Council Synthesis</strong><br>${produceSynthesis(q)}<br><br><em>Marked as draft guidance. Use RESOLVED / UNRESOLVED discipline externally.</em>`);
    document.getElementById('statusLine').innerText = 'Synthesis ready';
    log('Synthesis produced');
  }

  function fakeOpinion(h, q){
    const seeds = {
      "truthSeeker":"Goes beyond prevailing narrative, questions assumptions, detects hidden patterns.",
      "authority":"Represents official narrative, institutional voice, baseline consensus.",
      "strategist":"Turns knowledge into pathways forward — strategies, options, experiments, and next steps.",
      "archivist":"Retrieves relevant memory and records for user and council deliberation.",
      "secretariat":"Gathers, orders, and voices the council's collective deliberations and memory."
    };
    return `${seeds[h.id]} (re: â€œ${q.slice(0,60)}â€¦â€)`;
  }

  function produceSynthesis(q){
    const total = aiAgents.reduce((s,h)=>s+h.value,0);
    const w = aiAgents.reduce((o,h)=>{o[h.id]=h.value/total; return o;}, {});
    return [
      "Stage traction with three open demos, each < 10 minutes, recorded and shareable.",
      "Guard sovereignty: local-first memory, explicit consent toggles, transparent logs.",
      `Weighting applied â†' Truth-Seeker ${pct(w.truthSeeker)}, Secretariat ${pct(w.secretariat)}, Authority ${pct(w.authority)}.`,
      "Invest the remainder in onboarding and a waitlist flow that converts curiosity to commitment."
    ].join(' ');
  }
  function pct(v){ return Math.round(v*100) + "%" }

  // EVENTS
  document.getElementById('askBtn').addEventListener('click', runDemo);
  document.getElementById('viewAllMemoriesBtn').addEventListener('click', ()=>{
    log('View All Personal Memories clicked'); showToast('Opening personal memories...');
  });
  document.getElementById('bypassToggle').addEventListener('change', (e)=>{
    const isChecked = e.target.checked;
    log(`Bypass External LLM ${isChecked ? 'enabled' : 'disabled'}`);
    showToast(`External LLM ${isChecked ? 'bypassed' : 'enabled'}`);
  });
  document.getElementById('resolvedBtn').addEventListener('click', ()=>{
    log('Status marked as Resolved'); showToast('Marked as Resolved');
  });
  document.getElementById('unresolvedBtn').addEventListener('click', ()=>{
    log('Status marked as Unresolved'); showToast('Marked as Unresolved');
  });
  document.getElementById('dismissBtn').addEventListener('click', ()=>{
    log('Status marked as Dismissed'); showToast('Dismissed');
  });
  document.getElementById('sendToCommunityBtn').addEventListener('click', ()=>{
    populateThreadDropdown();
    document.getElementById('communityModal').style.display = 'flex';
    document.getElementById('threadSelect').focus();
  });

  document.getElementById('modalSendBtn').addEventListener('click', ()=>{
    const selectedThread = document.getElementById('threadSelect').value;
    const customThread = document.getElementById('threadNameInput').value.trim();
    const threadName = selectedThread || customThread;

    if(threadName) {
      log(`Sent to Community Thread: "${threadName}"`);
      showToast(`Sent to Community: ${threadName}`);
      document.getElementById('communityModal').style.display = 'none';
      document.getElementById('threadSelect').value = '';
      document.getElementById('threadNameInput').value = '';
    } else {
      showToast('Please select a thread or enter a thread name');
    }
  });

  document.getElementById('modalCancelBtn').addEventListener('click', ()=>{
    document.getElementById('communityModal').style.display = 'none';
    document.getElementById('threadSelect').value = '';
    document.getElementById('threadNameInput').value = '';
  });

  // Close modal when clicking outside
  document.getElementById('communityModal').addEventListener('click', (e)=>{
    if(e.target.id === 'communityModal') {
      document.getElementById('communityModal').style.display = 'none';
      document.getElementById('threadSelect').value = '';
      document.getElementById('threadNameInput').value = '';
    }
  });

  // Handle Enter key in input field
  document.getElementById('threadNameInput').addEventListener('keypress', (e)=>{
    if(e.key === 'Enter') {
      document.getElementById('modalSendBtn').click();
    }
  });
  document.getElementById('showAllCommsBtn').addEventListener('click', ()=>{
    log('Go To Community Console clicked');
    showToast('Opening all community interactions...');
    goTo("/demo/community");
  });

  // INIT
  renderGauges(); renderMemory(); renderAiAgentControls(); renderCommunityProjects(); seedChat();
</script>
</body>
</html>

